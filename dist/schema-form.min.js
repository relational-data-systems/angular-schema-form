!function(e,t){"function"==typeof define&&define.amd?define(["angular","objectpath","tv4"],t):"object"==typeof exports?module.exports=t(require("angular"),require("objectpath"),require("tv4")):e.schemaForm=t(e.angular,e.objectpath,e.tv4)}(this,function(e,t,r){var o=[];try{e.module("ngSanitize"),o.push("ngSanitize")}catch(i){}try{e.module("ui.sortable"),o.push("ui.sortable")}catch(i){}try{e.module("angularSpectrumColorpicker"),o.push("angularSpectrumColorpicker")}catch(i){}var n=e.module("schemaForm",o);return e.module("schemaForm").provider("sfPath",[function(){var r=window.ObjectPath||t,o={parse:r.parse};1===e.version.major&&e.version.minor<3?o.stringify=function(e){return Array.isArray(e)?e.join("."):e.toString()}:o.stringify=r.stringify,o.normalize=function(e,t){return o.stringify(Array.isArray(e)?e:o.parse(e),t)},this.parse=o.parse,this.stringify=o.stringify,this.normalize=o.normalize,this.$get=function(){return o}}]),e.module("schemaForm").factory("sfSelect",["sfPath",function(e){var t=/^\d+$/;return function(r,o,i){o||(o=this);var n="string"==typeof r?e.parse(r):r;if("undefined"!=typeof i&&1===n.length)return o[n[0]]=i,o;"undefined"!=typeof i&&"undefined"==typeof o[n[0]]&&(o[n[0]]=n.length>2&&t.test(n[1])?[]:{});for(var a=o[n[0]],l=1;l<n.length;l++){if(""===n[l])return void 0;if("undefined"!=typeof i){if(l===n.length-1)return a[n[l]]=i,i;var s=a[n[l]];("undefined"==typeof s||null===s)&&(s=t.test(n[l+1])?[]:{},a[n[l]]=s),a=s}else a&&(a=a[n[l]])}return a}}]),e.module("schemaForm").provider("sfBuilder",["sfPathProvider",function(t){var r=/[A-Z]/g,o=function(e,t){return t=t||"_",e.replace(r,function(e,r){return(r?t:"")+e.toLowerCase()})},i=0;"firstElementChild"in document.createDocumentFragment()||Object.defineProperty(DocumentFragment.prototype,"firstElementChild",{get:function(){for(var e,t=this.childNodes,r=0,o=t.length;o>r;++r)if(e=t[r],1===e.nodeType)return e;return null}});var n={sfField:function(e){e.fieldFrag.firstElementChild.setAttribute("sf-field",i),e.lookup["f"+i]=e.form,i++},ngModel:function(e){if(e.form.key){var r=e.form.key;e.state.keyRedaction&&(r=r.slice(e.state.keyRedaction));var o;if(e.state.modelValue)o=e.state.modelValue;else{var i=t.stringify(r).replace(/"/g,"&quot;");o=e.state.modelName||"model",i&&(o+=("["!==i[0]?".":"")+i)}for(var n=e.fieldFrag.querySelectorAll("[sf-field-model]"),a=0;a<n.length;a++){var l=n[a],s=l.getAttribute("sf-field-model");if(s&&""!==s)if("replaceAll"===s)for(var d=l.attributes,c=0;c<d.length;c++)d[c].value&&-1!==d[c].value.indexOf("$$value")&&(d[c].value=d[c].value.replace(/\$\$value\$\$/g,o));else{var f=l.getAttribute(s);f&&f.indexOf("$$value$$")?l.setAttribute(s,f.replace(/\$\$value\$\$/g,o)):l.setAttribute(s,o)}else l.setAttribute("ng-model",o)}}},simpleTransclusion:function(e){var t=e.build(e.form.items,e.path+".items",e.state);e.fieldFrag.firstChild.appendChild(t)},ngModelOptions:function(e){e.form.ngModelOptions&&Object.keys(e.form.ngModelOptions).length>0&&e.fieldFrag.firstChild.setAttribute("ng-model-options",JSON.stringify(e.form.ngModelOptions))},transclusion:function(e){var t=e.fieldFrag.querySelectorAll("[sf-field-transclude]");if(t.length)for(var r=0;r<t.length;r++){var o=t[r],i=o.getAttribute("sf-field-transclude")||"items",n=e.form[i];if(n){var a=e.build(n,e.path+"."+i,e.state);o.appendChild(a)}}},condition:function(e){if(e.form.condition){var r="evalExpr("+e.path+'.condition, { model: model, "arrayIndex": $index})';if(e.form.key){var o=t.stringify(e.form.key);r="evalExpr("+e.path+'.condition,{ model: model, "arrayIndex": $index, "modelValue": model'+("["===o[0]?"":".")+o+"})"}for(var i=e.fieldFrag.children||e.fieldFrag.childNodes,n=0;n<i.length;n++){var a=i[n];a instanceof Text||(ngIf=a.getAttribute("ng-if"),a.setAttribute("ng-if",ngIf?"("+ngIf+") || ("+r+")":r))}}},array:function(r){var o=r.fieldFrag.querySelector("[schema-form-array-items]");if(o){if(state=e.copy(r.state),state.keyRedaction=0,state.keyRedaction+=r.form.key.length+1,r.form.schema&&r.form.schema.items&&r.form.schema.items.type&&-1===r.form.schema.items.type.indexOf("object")&&-1===r.form.schema.items.type.indexOf("array")){t.stringify(r.form.key).replace(/"/g,"&quot;")+"[$index]";state.modelValue="modelArray[$index]"}else state.modelName="item";state.arrayCompatFlag=!0;var i=r.build(r.form.items,r.path+".items",state);o.appendChild(i)}},complexValidation:function(e){if(e.form.complexValidation){var r="evalExpr("+e.path+'.complexValidation, { model: model, "arrayIndex": $index})';if(e.form.key){var o=t.stringify(e.form.key);r="evalExpr("+e.path+'.complexValidation,{ model: model, "arrayIndex": $index, "modelValue": model'+("["===o[0]?"":".")+o+"})"}for(var i=e.fieldFrag.children||e.fieldFrag.childNodes,n=0;n<i.length;n++){var a=i[n];a.setAttribute("complex-validation",r)}}}};this.builders=n;var a=[n.sfField,n.ngModel,n.ngModelOptions,n.condition];this.stdBuilders=a,this.$get=["$templateCache","schemaFormDecorators","sfPath",function(e,t,r){var i=function(e,t){if(e.key){var o=t[r.stringify(e.key)];if(o){for(;o.firstChild;)o.removeChild(o.firstChild);return o}}},l=function(e,t,r,n,a,s,d){s=s||{},d=d||Object.create(null),a=a||"schemaForm.form";var c=document.createDocumentFragment();return e.reduce(function(e,c,f){if(!c.type)return e;var u=t[c.type]||t["default"];if(u.replace){var m;s.arrayCompatFlag=!1;var p=document.createElement("div"),h=r(c,u)||r(c,t["default"]);for(p.innerHTML=h,m=document.createDocumentFragment();p.childNodes.length>0;)m.appendChild(p.childNodes[0]);var v={fieldFrag:m,form:c,lookup:d,state:s,path:a+"["+f+"]",build:function(e,o,i){return l(e,t,r,n,o,i,d)}},g=c.builder||u.builder;"function"==typeof g?g(v):g.forEach(function(e){e(v)}),(i(c,n)||e).appendChild(m)}else{var y=document.createElement(o(t.__name,"-"));s.arrayCompatFlag?y.setAttribute("form","copyWithIndex($index)"):y.setAttribute("form",a+"["+f+"]"),(i(c,n)||e).appendChild(y)}return e},c),c};return{build:function(t,r,o,i){return l(t,r,function(t,r){return"template"===t.type?t.template:e.get(r.template)},o,void 0,void 0,i)},builder:n,stdBuilders:a,internalBuild:l}}]}]),e.module("schemaForm").provider("schemaFormDecorators",["$compileProvider","sfPathProvider",function(t,r){var o="",i={},n=function(e,t){"sfDecorator"===e&&(e=o);var r=i[e];return r[t.type]?r[t.type].template:r["default"].template},a=function(o){t.directive(o,["$parse","$compile","$http","$templateCache","$interpolate","$q","sfErrorMessage","sfPath","sfSelect",function(t,i,a,l,s,d,c,f,u){return{restrict:"AE",replace:!1,transclude:!1,scope:!0,require:"?^sfSchema",link:function(t,m,p,h){t.$on("schemaFormPropagateNgModelController",function(e,r){e.stopPropagation(),e.preventDefault(),t.ngModel=r}),t.showTitle=function(){return t.form&&t.form.notitle!==!0&&t.form.title},t.listToCheckboxValues=function(t){var r={};return e.forEach(t,function(e){r[e]=!0}),r},t.checkboxValuesToList=function(t){var r=[];return e.forEach(t,function(e,t){e&&r.push(t)}),r},t.buttonClick=function(r,o){e.isFunction(o.onClick)?o.onClick(r,o):e.isString(o.onClick)&&(h?h.evalInParentScope(o.onClick,{$event:r,form:o}):t.$eval(o.onClick,{$event:r,form:o}))},t.evalExpr=function(e,r){return h?h.evalInParentScope(e,r):t.$eval(e,r)},t.evalInScope=function(e,r){return e?t.$eval(e,r):void 0},t.interp=function(e,t){return e&&s(e)(t)},t.hasSuccess=function(){return t.ngModel?t.ngModel.$valid&&(!t.ngModel.$pristine||!t.ngModel.$isEmpty(t.ngModel.$modelValue)):!1},t.hasError=function(){return t.ngModel?t.ngModel.$invalid&&!t.ngModel.$pristine:!1},t.errorMessage=function(e){return c.interpolate(e&&e.code+""||"default",t.ngModel&&t.ngModel.$modelValue||"",t.ngModel&&t.ngModel.$viewValue||"",t.form,t.options&&t.options.validationMessage)};var v=t.$watch(p.form,function(s){if(s){s.ngModelOptions=s.ngModelOptions||{},t.form=s;var c;if("template"===s.type&&s.template)c=d.when(s.template);else{var p="template"===s.type?s.templateUrl:n(o,s);c=a.get(p,{cache:l}).then(function(e){return e.data})}c.then(function(o){if(s.key){var n=s.key?r.stringify(s.key).replace(/"/g,"&quot;"):"";o=o.replace(/\$\$value\$\$/g,"model"+("["!==n[0]?".":"")+n)}if(m.html(o),s.condition){var a='evalExpr(form.condition,{ model: model, "arrayIndex": arrayIndex})';s.key&&(a='evalExpr(form.condition,{ model: model, "arrayIndex": arrayIndex, "modelValue": model'+f.stringify(s.key)+"})"),e.forEach(m.children(),function(e){var t=e.getAttribute("ng-if");e.setAttribute("ng-if",t?"("+t+") || ("+a+")":a)})}if(s.complexValidation){var a='evalExpr(form.complexValidation,{ model: model, "arrayIndex": arrayIndex})';s.key&&(a='evalExpr(form.complexValidation,{ model: model, "arrayIndex": arrayIndex, "modelValue": model'+f.stringify(s.key)+"})"),e.forEach(m.children(),function(e){e.setAttribute("complex-validation",a)})}i(m.contents())(t)}),s.key&&(t.$on("schemaForm.error."+s.key.join("."),function(e,r,o,i,n){if(n=i,("complexValidation"!==r||o!==!0||t.ngModel.$error.complexValidation)&&((o===!0||o===!1)&&(i=o,o=void 0),(void 0==n||t.ngModel.$$parentForm.$name===n)&&t.ngModel&&r)){if(t.ngModel.$setDirty?t.ngModel.$setDirty():(t.ngModel.$dirty=!0,t.ngModel.$pristine=!1),o){if(s.validationMessage){if("string"==typeof s.validationMessage){var a=s.validationMessage;s.validationMessage={},s.validationMessage[202]=a}}else s.validationMessage={};s.validationMessage[r]=o}t.ngModel.$setValidity(r,i===!0),i===!0&&(t.ngModel.$validate(),t.$broadcast("schemaFormValidate"))}}),t.$on("$destroy",function(){if(!t.externalDestructionInProgress){var e=s.destroyStrategy||t.options&&t.options.destroyStrategy||"remove";if(s.key&&"retain"!==e){var r=t.model;if(s.key.length>1&&(r=u(s.key.slice(0,s.key.length-1),r)),void 0===r)return;var o=s.schema&&s.schema.type||"";"empty"===e&&-1!==o.indexOf("string")?r[s.key.slice(-1)]="":"empty"===e&&-1!==o.indexOf("object")?r[s.key.slice(-1)]={}:"empty"===e&&-1!==o.indexOf("array")?r[s.key.slice(-1)]=[]:"null"===e?r[s.key.slice(-1)]=null:delete r[s.key.slice(-1)]}}})),v()}})}}}])},l=function(r,o,i){i=e.isDefined(i)?i:!1,t.directive("sf"+e.uppercase(r[0])+r.substr(1),function(){return{restrict:"EAC",scope:!0,replace:!0,transclude:i,template:'<sf-decorator form="form"></sf-decorator>',link:function(t,o,i){var n={items:"c",titleMap:"c",schema:"c"},a={type:r},l=!0;e.forEach(i,function(r,o){if("$"!==o[0]&&0!==o.indexOf("ng")&&"sfField"!==o){var s=function(r){e.isDefined(r)&&r!==a[o]&&(a[o]=r,l&&a.type&&(a.key||e.isUndefined(i.key))&&(t.form=a,l=!1))};"model"===o?t.$watch(r,function(e){e&&t.model!==e&&(t.model=e)}):"c"===n[o]?t.$watchCollection(r,s):i.$observe(o,s)}})}}})};this.createDecorator=function(t,r){i[t]={__name:t},e.forEach(r,function(e,r){i[t][r]={template:e,replace:!1,builder:[]}}),i[o]||(o=t),a(t)},this.defineDecorator=function(t,r){i[t]={__name:t},e.forEach(r,function(r,o){r.builder=r.builder||[],r.replace=e.isDefined(r.replace)?r.replace:!0,i[t][o]=r}),i[o]||(o=t),a(t)},this.createDirective=l,this.createDirectives=function(t){e.forEach(t,function(e,t){l(t,e)})},this.decorator=function(e){return e=e||o,i[e]},this.addMapping=function(e,t,r,o,n){i[e]&&(i[e][t]={template:r,builder:o,replace:!!n})},this.defineAddOn=function(e,t,r,o){i[e]&&(i[e][t]={template:r,builder:o,replace:!0})},this.$get=function(){return{decorator:function(e){return i[e]||i[o]},defaultDecorator:o}},a("sfDecorator")}]),e.module("schemaForm").provider("sfErrorMessage",function(){var t={"default":"Field does not validate",0:"Invalid type, expected {{schema.type}}",1:"No enum match for: {{viewValue}}",10:'Data does not match any schemas from "anyOf"',11:'Data does not match any schemas from "oneOf"',12:'Data is valid against more than one schema from "oneOf"',13:'Data matches schema from "not"',100:"Value is not a multiple of {{schema.multipleOf}}",101:"{{viewValue}} is less than the allowed minimum of {{schema.minimum}}",102:"{{viewValue}} is equal to the exclusive minimum {{schema.minimum}}",103:"{{viewValue}} is greater than the allowed maximum of {{schema.maximum}}",104:"{{viewValue}} is equal to the exclusive maximum {{schema.maximum}}",105:"Value is not a valid number",200:"String is too short ({{viewValue.length}} chars), minimum {{schema.minLength}}",201:"String is too long ({{viewValue.length}} chars), maximum {{schema.maxLength}}",202:"String does not match pattern: {{schema.pattern}}",300:"Too few properties defined, minimum {{schema.minProperties}}",301:"Too many properties defined, maximum {{schema.maxProperties}}",302:"Required",303:"Additional properties not allowed",304:"Dependency failed - key must exist",400:"Array is too short ({{value.length}}), minimum {{schema.minItems}}",401:"Array is too long ({{value.length}}), maximum {{schema.maxItems}}",402:"Array items are not unique",403:"Additional items not allowed",500:"Format validation failed",501:'Keyword failed: "{{title}}"',600:"Circular $refs",1e3:"Unknown property (not in schema)"};t.number=t[105],t.required=t[302],t.min=t[101],t.max=t[103],t.maxlength=t[201],t.minlength=t[200],t.pattern=t[202],this.setDefaultMessages=function(e){t=e},this.getDefaultMessages=function(){return t},this.setDefaultMessage=function(e,r){t[e]=r},this.$get=["$interpolate",function(r){var o={};return o.defaultMessages=t,o.interpolate=function(o,i,n,a,l){l=l||{};var s=a.validationMessage||{};0===o.indexOf("tv4-")&&(o=o.substring(4));var d=s["default"]||l["default"]||"";[s,l,t].some(function(t){return e.isString(t)||e.isFunction(t)?(d=t,!0):t&&t[o]?(d=t[o],!0):void 0});var c={error:o,value:i,viewValue:n,form:a,schema:a.schema,title:a.title||a.schema&&a.schema.title};return e.isFunction(d)?d(c):r(d)(c)},o}]}),e.module("schemaForm").provider("schemaForm",["sfPathProvider",function(t){var r=function(e){if(Array.isArray(e)&&2==e.length){if("null"===e[0])return e[1];if("null"===e[1])return e[0]}return e},o=function(e){var t=[];return e.forEach(function(e){t.push({name:e,value:e})}),t},i=function(t,r){if(!e.isArray(t)){var o=[];return r?e.forEach(r,function(e,r){o.push({name:t[e],value:e})}):e.forEach(t,function(e,t){o.push({name:e,value:t})}),o}return t},n=function(t,o,i){var n=h[r(o.type)];if(n)for(var a,l=0;l<n.length;l++)if(a=n[l](t,o,i))return a.schema["x-schema-form"]&&e.isObject(a.schema["x-schema-form"])&&(a=e.extend(a,a.schema["x-schema-form"])),a},a=function(t,r,o){o=o||{};var n=o.global&&o.global.formDefaults?e.copy(o.global.formDefaults):{};return o.global&&o.global.supressPropertyTitles===!0?n.title=r.title:n.title=r.title||t,r.description&&(n.description=r.description),(o.required===!0||r.required===!0)&&(n.required=!0),r.maxLength&&(n.maxlength=r.maxLength),r.minLength&&(n.minlength=r.minLength),(r.readOnly||r.readonly)&&(n.readonly=!0),r.minimum&&(n.minimum=r.minimum+(r.exclusiveMinimum?1:0)),r.maximum&&(n.maximum=r.maximum-(r.exclusiveMaximum?1:0)),r.validationMessage&&(n.validationMessage=r.validationMessage),r.enumNames&&(n.titleMap=i(r.enumNames,r["enum"])),n.schema=r,n.ngModelOptions=n.ngModelOptions||{},n},l=function(e,o,i){if("string"===r(o.type)&&!o["enum"]){var n=a(e,o,i);return n.key=i.path,n.type="text",i.lookup[t.stringify(i.path)]=n,n}},s=function(e,o,i){if("number"===r(o.type)){var n=a(e,o,i);return n.key=i.path,n.type="number",i.lookup[t.stringify(i.path)]=n,n}},d=function(e,o,i){if("integer"===r(o.type)){var n=a(e,o,i);return n.key=i.path,n.type="number",i.lookup[t.stringify(i.path)]=n,n}},c=function(e,o,i){if("boolean"===r(o.type)){var n=a(e,o,i);return n.key=i.path,n.type="checkbox",i.lookup[t.stringify(i.path)]=n,n}},f=function(e,i,n){if("string"===r(i.type)&&i["enum"]){var l=a(e,i,n);return l.key=n.path,l.type="select",l.titleMap||(l.titleMap=o(i["enum"])),n.lookup[t.stringify(n.path)]=l,l}},u=function(e,i,n){if("array"===r(i.type)&&i.items&&i.items["enum"]){var l=a(e,i,n);return l.key=n.path,l.type="checkboxes",l.titleMap||(l.titleMap=o(i.items["enum"])),n.lookup[t.stringify(n.path)]=l,l}},m=function(o,i,l){if("object"===r(i.type)){var s=a(o,i,l);return s.type="fieldset",s.key=l.path,s.items=[],l.lookup[t.stringify(l.path)]=s,e.forEach(i.properties,function(e,r){var o=l.path.slice();if(o.push(r),l.ignore[t.stringify(o)]!==!0){var a=i.required&&-1!==i.required.indexOf(r),d=n(r,e,{path:o,required:a||!1,lookup:l.lookup,ignore:l.ignore,global:l.global});d&&s.items.push(d)}}),s}},p=function(e,o,i){if("array"===r(o.type)){var l=a(e,o,i);l.type="array",l.key=i.path,i.lookup[t.stringify(i.path)]=l;var s=o.required&&-1!==o.required.indexOf(i.path[i.path.length-1]),d=i.path.slice();return d.push(""),l.items=[n(e,o.items,{path:d,required:s||!1,lookup:i.lookup,ignore:i.ignore,global:i.global})],l}},h={string:[f,l],object:[m],number:[s],integer:[d],"boolean":[c],array:[u,p]},v=function(e){return e};this.defaults=h,this.stdFormObj=a,this.defaultFormDefinition=n,this.postProcess=function(e){v=e},this.appendRule=function(e,t){h[e]||(h[e]=[]),h[e].push(t)},this.prependRule=function(e,t){h[e]||(h[e]=[]),h[e].unshift(t)},this.createStandardForm=a,this.$get=function(){var o={};return o.merge=function(r,n,a,l,s,d){n=n||["*"],l=l||{},s=s||r.readonly||r.readOnly;var c=o.defaults(r,a,l),f=n.indexOf("*");-1!==f&&(n=n.slice(0,f).concat(c.form).concat(n.slice(f+1)));var u=c.lookup;return v(n.map(function(n){if("string"==typeof n&&(n={key:n}),n.key&&"string"==typeof n.key&&(n.key=t.parse(n.key)),n.titleMap&&(n.titleMap=i(n.titleMap)),n.itemForm){n.items=[];var c=t.stringify(n.key),f=u[c];e.forEach(f.items,function(t){var r=e.copy(n.itemForm);r.key=t.key,n.items.push(r)})}if(n.key){var m=t.stringify(n.key);if(u[m]){var p=u[m];e.forEach(p,function(e,t){void 0===n[t]&&(n[t]=p[t])})}}return s===!0&&(n.readonly=!0),n.items&&(n.items=o.merge(r,n.items,a,l,n.readonly,d)),n.tabs&&e.forEach(n.tabs,function(e){e.items=o.merge(r,e.items,a,l,n.readonly,d)}),"checkbox"===n.type&&e.isUndefined(n.schema["default"])&&(n.schema["default"]=!1),d&&"template"===n.type&&!n.template&&n.templateUrl&&d.push(n),n}))},o.defaults=function(t,o,i){var a=[],l={};if(o=o||{},i=i||{},"object"!==r(t.type))throw new Error('Not implemented. Only type "object" allowed at root level of schema.');return e.forEach(t.properties,function(e,r){if(o[r]!==!0){var s=t.required&&-1!==t.required.indexOf(r),d=n(r,e,{path:[r],lookup:l,ignore:o,required:s,global:i});d&&a.push(d)}}),{form:a,lookup:l}},o.traverseSchema=function(t,r,o,i){i=e.isDefined(i)?i:!0,o=o||[];var n=function(t,r,o){if(r(t,o),e.forEach(t.properties,function(e,t){var i=o.slice();i.push(t),n(e,r,i)}),!i&&t.items){var a=o.slice();a.push(""),n(t.items,r,a)}};n(t,r,o||[])},o.traverseForm=function(t,r){r(t),e.forEach(t.items,function(e){o.traverseForm(e,r)}),t.tabs&&e.forEach(t.tabs,function(t){e.forEach(t.items,function(e){o.traverseForm(e,r)})})},o}}]),function(){"use strict";function t(t,r,o,i){function n(e,t,r,n){var l,d,c,f;if(!s(e))return d=e,c=t,f=r,o(d,c,f);if(l=e,void 0===t&&void 0===r&&void 0===n)d=a(l),c=l.model;else if(void 0!==t&&void 0===r&&void 0===n)d=a(l),c=l.model,f=t;else if(void 0!==t&&void 0!==r&&void 0===n)d=t,c=r;else{if(void 0===t||void 0===r||void 0===n)throw i.error("sfModelValue - incorrect param combination: ",e,t,r,n),Error("sfModelValue - incorrect param combination");d=t,c=r,f=n}return o(d,c,f)}function a(t){if(!t.form||!t.form.key||!t.model)return null;d(t);for(var r=c(t),o=e.copy(t.form.key),n=o.length-1;n>=0;n--)if(""===o[n])if(r.length>0){var a=r.splice(-1,1)[0];o[n]=a}else i.error("sfModelValue#getModelPath - Cannot find any more array index for the model path",r,o);return 0!==r.length&&i.error("sfModelValue#getModelPath - array indices found along the scope hierarcy does not match to model path",r,o),o}function l(e,t){d(e);for(var r,o=c(e),n=/(\[\])+/g;null!==(r=n.exec(t));)for(var a=r[0].length/2,l=0;a>l;l++)l<o.length?t=t.replace(/\[\]/,"["+o[l]+"]"):i.error("sfModelValue#interpArrayIndex - Cannot find any more array index for the current match",o,r);return t}function s(e){return e instanceof r.constructor}function d(e){if(!s(e))throw e+" is not a scope";if(!e.form)throw e+" does not have a form object";if(!e.form.key)throw e+" does not have a form key";if(!e.model)throw"there is no model in this scope"}function c(t){for(var r=[],o=t;o;){var i=o.$index;e.isNumber(i)&&(r.unshift(i),o=o.$parent),o=o.$parent}return r}return n.getModelPath=a,n.interpArrayIndex=l,n}e.module("schemaForm").factory("sfModelValue",t),t.$inject=["sfPath","$rootScope","sfSelect","$log"]}(),e.module("schemaForm").factory("sfValidator",[function(){var t={};return t.validate=function(t,o){if(!t)return{valid:!0};var i=t.schema;if(!i)return{valid:!0};""===o&&(o=void 0),"number"===t.type&&null===o&&(o=void 0),-1!==["","text","textarea","date"].indexOf(t.type)&&null===o&&(o=void 0),-1!==["select","rds-dynamic-single-select","rds-dynamic-radios","radios-inline","radiobuttons"].indexOf(t.type)&&null===o&&(o=void 0);var n={type:"object",properties:{}},a=t.key[t.key.length-1];n.properties[a]=i,t.required&&(n.required=[a]);var l={};return e.isDefined(o)&&(l[a]=o),r.validateResult(l,n)},t}]),e.module("schemaForm").directive("sfArray",["sfSelect","schemaForm","sfValidator","sfPath",function(t,r,o,i){var n=function(e){return function(t){t.key&&(t.key[t.key.indexOf("")]=e)}};return{restrict:"A",scope:!0,require:"?ngModel",link:function(a,l,s,d){var c={};a.validateArray=e.noop,d&&a.$emit("schemaFormPropagateNgModelController",d);var f=a.$watch(s.sfArray,function(l){if(l){var s=t(l.key,a.model),u=i.normalize(l.key);if(a.$watch("model"+("["!==u[0]?".":"")+u,function(e){s=a.modelArray=e}),e.isUndefined(s)&&(s=[],t(l.key,a.model,s)),a.modelArray=s,l.items){var m=l.items[0];l.items.length>1&&(m={type:"section",items:l.items.map(function(t){return t.ngModelOptions=l.ngModelOptions,e.isUndefined(t.readonly)&&(t.readonly=l.readonly),t})})}if(a.copyWithIndex=function(t){if(!c[t]&&m){var o=e.copy(m);o.arrayIndex=t,r.traverseForm(o,n(t)),c[t]=o}return c[t]},a.appendToArray=function(){var o=s.length,i=a.copyWithIndex(o);if(r.traverseForm(i,function(r){if(r.key){var o;e.isDefined(r["default"])&&(o=r["default"]),e.isDefined(r.schema)&&e.isDefined(r.schema["default"])&&(o=r.schema["default"]),e.isDefined(o)&&t(r.key,a.model,o)}}),o===s.length){var n,d=t("schema.items.type",l);"object"===d?n={}:"array"===d&&(n=[]),s.push(n)}return a.validateArray(),s},a.deleteFromArray=function(e){return s.splice(e,1),a.validateArray(),d&&d.$setDirty&&d.$setDirty(),s},l.titleMap||l.startEmpty===!0||0!==s.length||a.appendToArray(),l.titleMap&&l.titleMap.length>0){a.titleMapValues=[];var p=function(e){a.titleMapValues=[],e=e||[],l.titleMap.forEach(function(t){a.titleMapValues.push(-1!==e.indexOf(t.value))})};p(a.modelArray),a.$watchCollection("modelArray",p),a.$watchCollection("titleMapValues",function(e,t){if(e&&e!==t){for(var r=a.modelArray;r.length>0;)r.pop();l.titleMap.forEach(function(t,o){e[o]&&r.push(t.value)}),a.validateArray()}})}if(d){var h;a.validateArray=function(){var e=o.validate(l,a.modelArray.length>0?a.modelArray:void 0);Object.keys(d.$error).filter(function(e){return 0===e.indexOf("tv4-")}).forEach(function(e){d.$setValidity(e,!0)}),e.valid!==!1||!e.error||""!==e.error.dataPath&&e.error.dataPath!=="/"+l.key[l.key.length-1]||(d.$setViewValue(a.modelArray),h=e.error,d.$setValidity("tv4-"+e.error.code,!1))},a.$on("schemaFormValidate",a.validateArray),a.hasSuccess=function(){return a.options&&a.options.pristine&&a.options.pristine.success===!1?d.$valid&&!d.$pristine&&!d.$isEmpty(d.$modelValue):d.$valid&&(!d.$pristine||!d.$isEmpty(d.$modelValue))},a.hasError=function(){return a.options&&a.options.pristine&&a.options.pristine.errors===!1?d.$invalid&&!d.$pristine:d.$invalid},a.schemaError=function(){return h}}f()}})}}}]),e.module("schemaForm").directive("sfChanged",function(){return{require:"ngModel",restrict:"AC",scope:!1,link:function(t,r,o,i){var n=t.$eval(o.sfChanged);n&&n.onChange&&i.$viewChangeListeners.push(function(){e.isFunction(n.onChange)?n.onChange(i.$modelValue,n):t.evalExpr(n.onChange,{modelValue:i.$modelValue,form:n})})}}}),e.module("schemaForm").directive("complexValidation",["sfValidator","$parse","sfSelect",function(e,t,r){return{restrict:"A",scope:!1,priority:500,require:"?ngModel",link:function(e,t,r,o,i){if(e.form.complexValidationMessage){if(e.form.validationMessage){if("string"==typeof e.form.validationMessage){var n=e.form.validationMessage;e.form.validationMessage={},e.form.validationMessage[202]=n}}else e.form.validationMessage={};e.form.validationMessage.complexValidation=e.form.complexValidationMessage}e.$watch(r.complexValidation,function(t){if(t)e.form.complexValidationResult=!0,e.ngModel.$$parentForm.$dirty&&e.$broadcast("schemaForm.error."+e.form.key.join("."),"complexValidation",!0);else{e.form.complexValidationResult=!1;var r=e.ngModel.$$parentForm.$dirty;!r&&e.ngModel.$$parentForm.$$parentForm&&(r=e.ngModel.$$parentForm.$$parentForm.$dirty),r&&e.$broadcast("schemaForm.error."+e.form.key.join("."),"complexValidation")}})}}}]),e.module("schemaForm").directive("old-sfField",["$parse","$compile","$http","$templateCache","$interpolate","$q","sfErrorMessage","sfPath","sfSelect",function(t,r,o,i,n,a,l,s,d){return{restrict:"AE",replace:!1,transclude:!1,scope:!0,require:"^sfSchema",link:{pre:function(e,t,r,o){e.$on("schemaFormPropagateNgModelController",function(t,r){t.stopPropagation(),t.preventDefault(),e.ngModel=r}),e.form=o.lookup["f"+r.sfField]},post:function(t,r,o,i){t.showTitle=function(){return t.form&&t.form.notitle!==!0&&t.form.title},t.listToCheckboxValues=function(t){var r={};return e.forEach(t,function(e){r[e]=!0}),r},t.checkboxValuesToList=function(t){var r=[];return e.forEach(t,function(e,t){e&&r.push(t)}),r},t.buttonClick=function(r,o){e.isFunction(o.onClick)?o.onClick(r,o):e.isString(o.onClick)&&(i?i.evalInParentScope(o.onClick,{$event:r,form:o}):t.$eval(o.onClick,{$event:r,form:o}))},t.evalExpr=function(e,r){return i?i.evalInParentScope(e,r):t.$eval(e,r)},t.evalInScope=function(e,r){return e?t.$eval(e,r):void 0},t.interp=function(e,t){return e&&n(e)(t)},t.hasSuccess=function(){return t.ngModel?t.options&&t.options.pristine&&t.options.pristine.success===!1?t.ngModel.$valid&&!t.ngModel.$pristine&&!t.ngModel.$isEmpty(t.ngModel.$modelValue):t.ngModel.$valid&&(!t.ngModel.$pristine||!t.ngModel.$isEmpty(t.ngModel.$modelValue)):!1},t.hasError=function(){return t.ngModel?t.options&&t.options.pristine&&t.options.pristine.errors===!1?t.ngModel.$invalid&&!t.ngModel.$pristine:t.ngModel.$invalid:!1},t.errorMessage=function(e){return l.interpolate(e&&e.code+""||"default",t.ngModel&&t.ngModel.$modelValue||"",t.ngModel&&t.ngModel.$viewValue||"",t.form,t.options&&t.options.validationMessage)};var a=t.form;a.key&&(t.$on("schemaForm.error."+a.key.join("."),function(e,r,o,i,n){console.log("field.js triggered!"),n=i,(o===!0||o===!1)&&(i=o,o=void 0),(void 0==n||t.ngModel.$$parentForm.$name===n)&&t.ngModel&&r&&(t.ngModel.$setDirty?t.ngModel.$setDirty():(t.ngModel.$dirty=!0,t.ngModel.$pristine=!1),o&&(a.validationMessage||(a.validationMessage={}),a.validationMessage[r]=o),t.ngModel.$setValidity(r,i===!0),i===!0&&(t.ngModel.$validate(),t.$broadcast("schemaFormValidate")))}),t.$on("$destroy",function(){if(!t.externalDestructionInProgress){var e=a.destroyStrategy||t.options&&t.options.destroyStrategy||"remove";if(a.key&&"retain"!==e){var r=t.model;if(a.key.length>1&&(r=d(a.key.slice(0,a.key.length-1),r)),void 0===r)return;var o=a.schema&&a.schema.type||"";"empty"===e&&-1!==o.indexOf("string")?r[a.key.slice(-1)]="":"empty"===e&&-1!==o.indexOf("object")?r[a.key.slice(-1)]={}:"empty"===e&&-1!==o.indexOf("array")?r[a.key.slice(-1)]=[]:"null"===e?r[a.key.slice(-1)]=null:delete r[a.key.slice(-1)]}}}))}}}}]),e.module("schemaForm").directive("sfMessage",["$injector","sfErrorMessage",function(t,r){var o=t.has("$sanitize")?t.get("$sanitize"):function(e){return e};return{scope:!1,restrict:"EA",link:function(t,i,n){var a="";n.sfMessage&&t.$watch(n.sfMessage,function(e){e&&(a=o(e),d(!!t.ngModel))});var l,s=function(e){e!==l&&(i.html(e),l=e)},d=function(o){if(o)if(t.hasError()){var i=[];e.forEach(t.ngModel&&t.ngModel.$error,function(e,t){e&&i.push(t)}),i=i.filter(function(e){return"schemaForm"!==e});var n=i[0];s(n?r.interpolate(n,t.ngModel.$modelValue,t.ngModel.$viewValue,t.form,t.options&&t.options.validationMessage):a)}else s(a);else s(a)};d();var c=t.$watch("ngModel",function(e){e&&(e.$parsers.push(function(e){return d(!0),e}),e.$formatters.push(function(e){return d(!0),e}),c())});t.$watchCollection("ngModel.$error",function(){d(!!t.ngModel)})}}}]),e.module("schemaForm").directive("sfNewArray",["sfSelect","sfPath","schemaForm",function(t,r,o){return{scope:!1,link:function(i,n,a){i.min=0,i.modelArray=i.$eval(a.sfNewArray);var l=function(){i.modelArray=i.$eval(a.sfNewArray),(!(i.ngModel&&i.ngModel.$pristine&&i.firstDigest)||i.options&&i.options.validateOnRender===!0)&&i.validateField&&i.validateField()},s=function(){i.form&&i.form.onChange&&(e.isFunction(i.form.onChange)?i.form.onChange(i.modelArray,i.form):i.evalExpr(i.form.onChange,{modelValue:i.modelArray,form:i.form}))},d=function(){var e=i.modelArray;if(!e){var o=r.parse(a.sfNewArray);e=[],t(o,i,e),i.modelArray=e}return e},c=i.$watch("form",function(e){if(e){if(e.titleMap||e.startEmpty===!0||i.modelArray&&0!==i.modelArray.length||i.appendToArray(),i.form&&i.form.schema&&i.form.schema.uniqueItems===!0?(i.$watch(a.sfNewArray,l,!0),i.$watch([a.sfNewArray,a.sfNewArray+".length"],s)):i.$watchGroup?i.$watchGroup([a.sfNewArray,a.sfNewArray+".length"],function(){l(),s()}):(i.$watch(a.sfNewArray,function(){l(),s()}),i.$watch(a.sfNewArray+".length",function(){l(),s()})),e.titleMap&&e.titleMap.length>0){i.titleMapValues=[];var t=function(t){i.titleMapValues=[],t=t||[],e.titleMap.forEach(function(e){i.titleMapValues.push(-1!==t.indexOf(e.value))})};t(i.modelArray),i.$watchCollection("modelArray",t),i.$watchCollection("titleMapValues",function(t,r){if(t&&t!==r){var o=d();e.titleMap.forEach(function(e,r){var i=o.indexOf(e.value);-1===i&&t[r]&&o.push(e.value),-1===i||t[r]||o.splice(i,1)}),i.validateField&&i.validateField()}})}c()}});i.appendToArray=function(){var r,n=d();if(i.form&&i.form.schema&&i.form.schema.items){var a=i.form.schema.items;a.type&&-1!==a.type.indexOf("object")?(r={},i.options&&i.options.setSchemaDefaults===!1||(r=e.isDefined(a["default"])?a["default"]:r,r&&o.traverseSchema(a,function(o,i){e.isDefined(o["default"])&&t(i,r,o["default"])}))):a.type&&-1!==a.type.indexOf("array")?(r=[],i.options&&i.options.setSchemaDefaults===!1||(r=a["default"]||r)):i.options&&i.options.setSchemaDefaults===!1||(r=a["default"]||r)}return n.push(r),n},i.deleteFromArray=function(e){var t=i.modelArray;return t&&t.splice(e,1),t},i.indexDown=function(e){var t=i.modelArray;if(t&&e>0&&e<t.length){var r=t[e-1];return t[e-1]=t[e],t[e]=r,e-1}return e},i.indexUp=function(e){var t=i.modelArray;if(t&&e>=0&&e<t.length-1){var r=t[e+1];return t[e+1]=t[e],t[e]=r,e+1}return e};var f=function(e){return function(t){t.key&&(t.key[t.key.indexOf("")]=e)}},u={};i.copyWithIndex=function(t){var r=i.form;if(!u[t]){var n=r.items[0];if(r.items.length>1&&(n={type:"section",items:r.items.map(function(t){return t.ngModelOptions=r.ngModelOptions,e.isUndefined(t.readonly)&&(t.readonly=r.readonly),t})}),n){var a=e.copy(n);a.arrayIndex=t,o.traverseForm(a,f(t)),u[t]=a}}return u[t]}}}}]),function(){"use strict";function t(e,t,r,o){function i(e,o,i,n){function a(){var r=/({)([^}]*)(})/gm,o=c.remoteValidation.replace(r,"$1$1 model.$2 $3$3"),i=/{{([^}]*)}}/gm;if(o===c.remoteValidation)e.$watch("model."+c.key.join("."),function(r,i){if(r){var n=t(o,!1,null,!0),a=n(e);l(a)}});else for(var n;null!==(n=i.exec(o));)e.$watch(n[1],function(r,i){if(r){var n=t(o,!1,null,!0),a=n(e);l(a)}})}function l(e){r({method:"GET",url:e}).then(function(e){var t=e.data.validation;d(t)})["catch"](function(e){})}function s(){if(e.form.remoteValidationMessage){if(e.form.validationMessage){if("string"==typeof e.form.validationMessage){var t=e.form.validationMessage;e.form.validationMessage={},e.form.validationMessage[202]=t}}else e.form.validationMessage={};e.form.validationMessage.remoteValidation=e.form.remoteValidationMessage;
}}function d(t){if(t)e.form.remoteValidationResult=!0,e.ngModel.$$parentForm.$dirty&&e.$root.$broadcast("schemaForm.error."+e.form.key.join("."),"remoteValidation",!0);else{e.form.remoteValidationResult=!1;var r=e.ngModel.$$parentForm.$dirty;!r&&e.ngModel.$$parentForm.$$parentForm&&(r=e.ngModel.$$parentForm.$$parentForm.$dirty),r&&e.$root.$broadcast("schemaForm.error."+e.form.key.join("."),"remoteValidation",!1)}}if(e.form.remoteValidation){var c=e.form;e.model;s(),a()}}var n={restrict:"A",scope:!1,priority:500,require:"^ngModel",link:i};return n}e.module("schemaForm").directive("remoteValidation",t),t.$inject=["$log","$interpolate","$http","$compile"]}(),e.module("schemaForm").directive("sfSchema",["$compile","$http","$templateCache","$q","schemaForm","schemaFormDecorators","sfSelect","sfPath","sfBuilder",function(t,r,o,i,n,a,l,s,d){return{scope:{schema:"=sfSchema",initialForm:"=sfForm",model:"=sfModel",options:"=sfOptions"},controller:["$scope",function(e){this.evalInParentScope=function(t,r){return e.$parent.$eval(t,r)};var t=this;e.lookup=function(e){return e&&(t.lookup=e),t.lookup}}],replace:!1,restrict:"A",transclude:!0,require:"?form",link:function(s,c,f,u,m){s.formCtrl=u;var p={};m(s,function(e){if(e.addClass("schema-form-ignore"),c.prepend(e),c[0].querySelectorAll){var t=c[0].querySelectorAll("[ng-model]");if(t)for(var r=0;r<t.length;r++){var o=t[r].getAttribute("ng-model");p[o.substring(o.indexOf(".")+1)]=!0}}});var h,v={},g=function(e,t){var a=[],l=n.merge(e,t,p,s.options,void 0,a);a.length>0?i.all(a.map(function(e){return r.get(e.templateUrl,{cache:o}).then(function(t){e.template=t.data})})).then(function(){y(e,t,l)}):y(e,t,l)},y=function(r,o,i){h&&(s.externalDestructionInProgress=!0,h.$destroy(),s.externalDestructionInProgress=!1),h=s.$new(),h.schemaForm={form:i,schema:r},c.children(":not(.schema-form-ignore)").remove();for(var u={},m=c[0].querySelectorAll("*[sf-insert-field]"),p=0;p<m.length;p++)u[m[p].getAttribute("sf-insert-field")]=m[p];var v=a.decorator(f.sfUseDecorator),g=Object.create(null);s.lookup(g),c[0].appendChild(d.build(i,v,u,g)),h.firstDigest=!0,setTimeout(function(){h.firstDigest=!1},0),t(c.children())(h),s.options&&s.options.setSchemaDefaults===!1||n.traverseSchema(r,function(t,r){if(e.isDefined(t["default"])){var o=l(r,s.model);e.isUndefined(o)&&l(r,s.model,t["default"])}}),s.$emit("sf-render-finished",c)},$=["*"];s.$watch(function(){var e=s.schema,t=s.initialForm||$;t&&e&&e.type&&(v.form!==t||v.schema!==e)&&Object.keys(e.properties).length>0&&(v.schema=e,v.form=t,g(e,t))}),s.$on("schemaFormRedraw",function(){var t=s.schema,r=s.initialForm?e.copy(s.initialForm):["*"];t&&g(t,r)}),s.$on("$destroy",function(){s.externalDestructionInProgress=!0}),s.evalExpr=function(e,t){return s.$parent.$eval(e,t)}}}}]),e.module("schemaForm").directive("schemaValidate",["sfValidator","$parse","sfSelect",function(t,r,o){return{restrict:"A",scope:!1,priority:500,require:"ngModel",link:function(r,i,n,a){r.$emit("schemaFormPropagateNgModelController",a);var l=null,s=r.$eval(n.schemaValidate);s.copyValueTo&&a.$viewChangeListeners.push(function(){var t=s.copyValueTo;e.forEach(t,function(e){o(e,r.model,a.$modelValue)})});var d=function(e){if(!s)return e;if(r.options&&r.options.tv4Validation===!1)return e;var o={valid:!0};if("uiselectmultiple"!==s.type)var o=t.validate(s,e);return Object.keys(a.$error).filter(function(e){return 0===e.indexOf("tv4-")}).forEach(function(e){a.$setValidity(e,!0)}),a.$setValidity("complexValidation",!0),a.$setValidity("remoteValidation",!0),o.valid?s.complexValidationResult===!1?(a.$setValidity("complexValidation",!1),l={code:"complexValidation"},e):s.remoteValidationResult===!1?(a.$setValidity("remoteValidation",!1),l={code:"remoteValidation"},e):e:(a.$setValidity("tv4-"+o.error.code,!1),l=o.error,a.$validators?e:void 0)};"function"==typeof s.ngModel&&s.ngModel(a),["$parsers","$viewChangeListeners","$formatters"].forEach(function(e){s[e]&&a[e]&&s[e].forEach(function(t){a[e].push(t)})}),["$validators","$asyncValidators"].forEach(function(t){s[t]&&a[t]&&e.forEach(s[t],function(e,r){a[t][r]=e})}),a.$parsers.push(d),a.$validators&&(a.$validators.schemaForm=function(){return!Object.keys(a.$error).some(function(e){return"schemaForm"!==e&&"complexValidation"!==e&&"remoteValidation"!==e})});var c=s.schema;r.validateField=function(e){(void 0==e||a.$$parentForm.$name===e)&&(c&&-1!==c.type.indexOf("array")&&d(a.$modelValue),a.$setDirty?(a.$setDirty(),a.$setViewValue(a.$viewValue),a.$commitViewValue(),s.required&&a.$isEmpty(a.$modelValue)?a.$setValidity("tv4-302",!1):s.complexValidationResult===!1?a.$setValidity("complexValidation",!1):s.complexValidationResult?a.$setValidity("complexValidation",!0):s.remoteValidationResult===!1?a.$setValidity("remoteValidation",!1):s.remoteValidationResult&&a.$setValidity("complexValidation",!0)):a.$setViewValue(a.$viewValue))},a.$formatters.push(function(e){return!a.$pristine||!r.firstDigest||r.options&&r.options.validateOnRender===!0?(d(a.$modelValue),e):e}),r.$on("schemaFormValidate",function(e,t){r.validateField(t)}),r.schemaError=function(){return l}}}}]),e.module("schemaForm").directive("sfField",["$parse","$compile","$http","$templateCache","$interpolate","$q","sfErrorMessage","sfPath","sfSelect","sfModelValue","$log",function(t,r,o,i,n,a,l,s,d,c,f){return{restrict:"AE",replace:!1,transclude:!1,scope:!0,require:"^sfSchema",link:{pre:function(e,t,r,o){e.$on("schemaFormPropagateNgModelController",function(t,r){t.stopPropagation(),t.preventDefault(),e.ngModel=r}),e.form=o.lookup["f"+r.sfField]},post:function(t,r,o,i){t.showTitle=function(){return t.form&&t.form.notitle!==!0&&t.form.title},t.listToCheckboxValues=function(t){var r={};return e.forEach(t,function(e){r[e]=!0}),r},t.checkboxValuesToList=function(t){var r=[];return e.forEach(t,function(e,t){e&&r.push(t)}),r},t.buttonClick=function(r,o){e.isFunction(o.onClick)?o.onClick(r,o):e.isString(o.onClick)&&(i?i.evalInParentScope(o.onClick,{$event:r,form:o}):t.$eval(o.onClick,{$event:r,form:o}))},t.evalExpr=function(e,r){return i?i.evalInParentScope(e,r):t.$eval(e,r)},t.evalInScope=function(e,r){return e?t.$eval(e,r):void 0},t.interp=function(e,t){return e&&n(e)(t)},t.modelValue=function(e){var t=this;return c(t,e)},t.interpArrayIndex=function(e){var t=this;return c.interpArrayIndex(t,e)},t.getModelPath=function(){var e=this;return c.getModelPath(e)},t.hasSuccess=function(){return t.ngModel?t.options&&t.options.pristine&&t.options.pristine.success===!1?t.ngModel.$valid&&!t.ngModel.$pristine&&!t.ngModel.$isEmpty(t.ngModel.$modelValue):t.ngModel.$valid&&(!t.ngModel.$pristine||!t.ngModel.$isEmpty(t.ngModel.$modelValue)):!1},t.hasError=function(){return t.ngModel?t.options&&t.options.pristine&&t.options.pristine.errors===!1?t.ngModel.$invalid&&!t.ngModel.$pristine:t.ngModel.$invalid:!1},t.errorMessage=function(e){return l.interpolate(e&&e.code+""||"default",t.ngModel&&t.ngModel.$modelValue||"",t.ngModel&&t.ngModel.$viewValue||"",t.form,t.options&&t.options.validationMessage)};var a=t.form;a.key&&(t.$on("schemaForm.error."+a.key.join("."),function(e,r,o,i){if(("complexValidation"!==r||o!==!0||t.ngModel.$error.complexValidation)&&("remoteValidation"!==r||o!==!0||t.ngModel.$error.remoteValidation)&&((o===!0||o===!1)&&(i=o,o=void 0),t.ngModel&&r)){if(t.ngModel.$setDirty?t.ngModel.$setDirty():(t.ngModel.$dirty=!0,t.ngModel.$pristine=!1),o){if(a.validationMessage){if("string"==typeof a.validationMessage){var n=a.validationMessage;a.validationMessage={},a.validationMessage[202]=n}}else a.validationMessage={};a.validationMessage[r]=o}t.ngModel.$setValidity(r,i===!0),i===!0&&(t.ngModel.$validate(),t.$broadcast("schemaFormValidate"))}}),t.$on("$destroy",function(){if(!t.externalDestructionInProgress){var e=a.destroyStrategy||t.options&&t.options.destroyStrategy||"remove";if(a.key&&"retain"!==e){var r=t.model;if(a.key.length>1&&(r=d(a.key.slice(0,a.key.length-1),r)),void 0===r)return;var o=a.schema&&a.schema.type||"";"empty"===e&&-1!==o.indexOf("string")?r[a.key.slice(-1)]="":"empty"===e&&-1!==o.indexOf("object")?r[a.key.slice(-1)]={}:"empty"===e&&-1!==o.indexOf("array")?r[a.key.slice(-1)]=[]:"null"===e?r[a.key.slice(-1)]=null:delete r[a.key.slice(-1)]}}}))}}}}]),n});