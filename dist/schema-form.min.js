!function(e,t){"function"==typeof define&&define.amd?define(["angular","objectpath","tv4"],t):"object"==typeof exports?module.exports=t(require("angular"),require("objectpath"),require("tv4")):e.schemaForm=t(e.angular,e.objectpath,e.tv4)}(this,function(e,t,r){var n=[];try{e.module("ngSanitize"),n.push("ngSanitize")}catch(i){}try{e.module("ui.sortable"),n.push("ui.sortable")}catch(i){}try{e.module("angularSpectrumColorpicker"),n.push("angularSpectrumColorpicker")}catch(i){}var o=e.module("schemaForm",n);return e.module("schemaForm").provider("sfPath",[function(){var r=window.ObjectPath||t,n={parse:r.parse};1===e.version.major&&e.version.minor<3?n.stringify=function(e){return Array.isArray(e)?e.join("."):e.toString()}:n.stringify=r.stringify,n.normalize=function(e,t){return n.stringify(Array.isArray(e)?e:n.parse(e),t)},this.parse=n.parse,this.stringify=n.stringify,this.normalize=n.normalize,this.$get=function(){return n}}]),e.module("schemaForm").factory("sfSelect",["sfPath",function(e){var t=/^\d+$/;return function(r,n,i){n||(n=this);var o="string"==typeof r?e.parse(r):r;if("undefined"!=typeof i&&1===o.length)return n[o[0]]=i,n;"undefined"!=typeof i&&"undefined"==typeof n[o[0]]&&(n[o[0]]=o.length>2&&t.test(o[1])?[]:{});for(var a=n[o[0]],l=1;l<o.length;l++){if(""===o[l])return void 0;if("undefined"!=typeof i){if(l===o.length-1)return a[o[l]]=i,i;var s=a[o[l]];("undefined"==typeof s||null===s)&&(s=t.test(o[l+1])?[]:{},a[o[l]]=s),a=s}else a&&(a=a[o[l]])}return a}}]),e.module("schemaForm").provider("sfBuilder",["sfPathProvider",function(t){var r=/[A-Z]/g,n=function(e,t){return t=t||"_",e.replace(r,function(e,r){return(r?t:"")+e.toLowerCase()})},i=0;"firstElementChild"in document.createDocumentFragment()||Object.defineProperty(DocumentFragment.prototype,"firstElementChild",{get:function(){for(var e,t=this.childNodes,r=0,n=t.length;n>r;++r)if(e=t[r],1===e.nodeType)return e;return null}});var o={sfField:function(e){e.fieldFrag.firstElementChild.setAttribute("sf-field",i),e.lookup["f"+i]=e.form,i++},ngModel:function(e){if(e.form.key){var r=e.form.key;e.state.keyRedaction&&(r=r.slice(e.state.keyRedaction));var n;if(e.state.modelValue)n=e.state.modelValue;else{var i=t.stringify(r).replace(/"/g,"&quot;");n=e.state.modelName||"model",i&&(n+=("["!==i[0]?".":"")+i)}for(var o=e.fieldFrag.querySelectorAll("[sf-field-model]"),a=0;a<o.length;a++){var l=o[a],s=l.getAttribute("sf-field-model");if(s&&""!==s)if("replaceAll"===s)for(var u=l.attributes,d=0;d<u.length;d++)u[d].value&&-1!==u[d].value.indexOf("$$value")&&(u[d].value=u[d].value.replace(/\$\$value\$\$/g,n));else{var f=l.getAttribute(s);f&&f.indexOf("$$value$$")?l.setAttribute(s,f.replace(/\$\$value\$\$/g,n)):l.setAttribute(s,n)}else l.setAttribute("ng-model",n)}}},simpleTransclusion:function(e){var t=e.build(e.form.items,e.path+".items",e.state);e.fieldFrag.firstChild.appendChild(t)},ngModelOptions:function(e){e.form.ngModelOptions&&Object.keys(e.form.ngModelOptions).length>0&&e.fieldFrag.firstChild.setAttribute("ng-model-options",JSON.stringify(e.form.ngModelOptions))},transclusion:function(e){var t=e.fieldFrag.querySelectorAll("[sf-field-transclude]");if(t.length)for(var r=0;r<t.length;r++){var n=t[r],i=n.getAttribute("sf-field-transclude")||"items",o=e.form[i];if(o){var a=e.build(o,e.path+"."+i,e.state);n.appendChild(a)}}},condition:function(e){if(e.form.condition){var r="evalExpr("+e.path+'.condition, { model: model, "arrayIndex": $index})';if(e.form.key){var n=t.stringify(e.form.key);r="evalExpr("+e.path+'.condition,{ model: model, "arrayIndex": $index,"modelValue": model'+("["===n[0]?"":".")+n+"})"}for(var i=e.fieldFrag.children||e.fieldFrag.childNodes,o=0;o<i.length;o++){var a=i[o];a instanceof Text||(ngIf=a.getAttribute("ng-if"),a.setAttribute("ng-if",ngIf?"("+ngIf+") || ("+r+")":r))}}},array:function(r){for(var n=r.fieldFrag.querySelectorAll("[schema-form-array-items]"),i=0;i<n.length;i++){var o=n[i];if(o){if(state=e.copy(r.state),state.keyRedaction=0,state.keyRedaction+=r.form.key.length+1,r.form.schema&&r.form.schema.items&&r.form.schema.items.type&&-1===r.form.schema.items.type.indexOf("object")&&-1===r.form.schema.items.type.indexOf("array")){t.stringify(r.form.key).replace(/"/g,"&quot;")+"[$index]";state.modelValue="modelArray[$index]"}else state.modelName="item";state.arrayCompatFlag=!0;var a=r.build(r.form.items,r.path+".items",state);o.appendChild(a)}}},jsExpression:function(e){if(e.form.schema&&e.form.schema.jsExpression){var r="evalExpr("+e.path+'.jsExpression, { "model": model, "arrayIndex": $index })';if(e.form.key){var n=t.stringify(e.form.key);n=n.replace(/\[''\]/g,"[$index]"),r="evalExpr("+e.path+'.schema.jsExpression, { "model": model, "arrayIndex": $index, "modelValue": model'+("["===n[0]?"":".")+n+"})"}for(var i=e.fieldFrag.children||e.fieldFrag.childNodes,o=0;o<i.length;o++){var a=i[o];a.setAttribute("js-expression",r)}}}};this.builders=o;var a=[o.sfField,o.ngModel,o.ngModelOptions,o.condition,o.jsExpression];this.stdBuilders=a,this.$get=["$templateCache","schemaFormDecorators","sfPath",function(e,t,r){var i=function(e,t){if(e.key){var n=t[r.stringify(e.key)];if(n){for(;n.firstChild;)n.removeChild(n.firstChild);return n}}},l=function(e,t,r,o,a,s,u){s=s||{},u=u||Object.create(null),a=a||"schemaForm.form";var d=document.createDocumentFragment();return e.reduce(function(e,d,f){if(!d.type)return e;var c=t[d.type]||t["default"];if(c.replace){var m;s.arrayCompatFlag=!1;var p=document.createElement("div"),h=r(d,c)||r(d,t["default"]);for(p.innerHTML=h,m=document.createDocumentFragment();p.childNodes.length>0;)m.appendChild(p.childNodes[0]);var v={fieldFrag:m,form:d,lookup:u,state:s,path:a+"["+f+"]",build:function(e,n,i){return l(e,t,r,o,n,i,u)}},y=d.builder||c.builder;"function"==typeof y?y(v):y.forEach(function(e){e(v)}),(i(d,o)||e).appendChild(m)}else{var g=document.createElement(n(t.__name,"-"));s.arrayCompatFlag?g.setAttribute("form","copyWithIndex($index)"):g.setAttribute("form",a+"["+f+"]"),(i(d,o)||e).appendChild(g)}return e},d),d};return{build:function(t,r,n,i){return l(t,r,function(t,r){return"template"===t.type?t.template:e.get(r.template)},n,void 0,void 0,i)},builder:o,stdBuilders:a,internalBuild:l}}]}]),e.module("schemaForm").provider("schemaFormDecorators",["$compileProvider","sfPathProvider",function(t,r){var n="",i={},o=function(e,t){"sfDecorator"===e&&(e=n);var r=i[e];return r[t.type]?r[t.type].template:r["default"].template},a=function(n){t.directive(n,["$parse","$compile","$http","$templateCache","$interpolate","$q","sfErrorMessage","sfPath","sfSelect",function(t,i,a,l,s,u,d,f,c){return{restrict:"AE",replace:!1,transclude:!1,scope:!0,require:"?^sfSchema",link:function(t,m,p,h){t.$on("schemaFormPropagateNgModelController",function(e,r){e.stopPropagation(),e.preventDefault(),t.ngModel=r}),t.showTitle=function(){return t.form&&t.form.notitle!==!0&&t.form.title},t.listToCheckboxValues=function(t){var r={};return e.forEach(t,function(e){r[e]=!0}),r},t.checkboxValuesToList=function(t){var r=[];return e.forEach(t,function(e,t){e&&r.push(t)}),r},t.buttonClick=function(r,n){e.isFunction(n.onClick)?n.onClick(r,n):e.isString(n.onClick)&&(h?h.evalInParentScope(n.onClick,{$event:r,form:n}):t.$eval(n.onClick,{$event:r,form:n}))},t.evalExpr=function(e,r){return h?h.evalInParentScope(e,r):t.$eval(e,r)},t.evalInScope=function(e,r){return e?t.$eval(e,r):void 0},t.interp=function(e,t){return e&&s(e)(t)},t.hasSuccess=function(){return t.ngModel?t.ngModel.$valid&&(!t.ngModel.$pristine||!t.ngModel.$isEmpty(t.ngModel.$modelValue)):!1},t.hasError=function(){return t.ngModel?t.ngModel.$invalid&&!t.ngModel.$pristine:!1},t.errorMessage=function(e){return d.interpolate(e&&e.code+""||"default",t.ngModel&&t.ngModel.$modelValue||"",t.ngModel&&t.ngModel.$viewValue||"",t.form,t.options&&t.options.validationMessage)};var v=t.$watch(p.form,function(s){if(s){s.ngModelOptions=s.ngModelOptions||{},t.form=s;var d;if("template"===s.type&&s.template)d=u.when(s.template);else{var p="template"===s.type?s.templateUrl:o(n,s);d=a.get(p,{cache:l}).then(function(e){return e.data})}d.then(function(n){if(s.key){var o=s.key?r.stringify(s.key).replace(/"/g,"&quot;"):"";n=n.replace(/\$\$value\$\$/g,"model"+("["!==o[0]?".":"")+o)}if(m.html(n),s.condition){var a='evalExpr(form.condition,{ model: model, "arrayIndex": arrayIndex})';s.key&&(a='evalExpr(form.condition,{ model: model, "arrayIndex": arrayIndex, "modelValue": model'+f.stringify(s.key)+"})"),e.forEach(m.children(),function(e){var t=e.getAttribute("ng-if");e.setAttribute("ng-if",t?"("+t+") || ("+a+")":a)})}if(s.schema.jsExpression){var a='evalExpr(form.schema.jsExpression,{ model: model, "arrayIndex": arrayIndex})';s.key&&(a='evalExpr(form.schema.jsExpression,{ model: model, "arrayIndex": arrayIndex, "modelValue": model'+f.stringify(s.key)+"})"),e.forEach(m.children(),function(e){e.setAttribute("js-expression",a)})}i(m.contents())(t)}),s.key&&(t.$on("schemaForm.error."+s.key.join("."),function(e,r,n,i,o){if(o=i,("jsExpression"!==r||n!==!0||t.ngModel.$error.jsExpression)&&((n===!0||n===!1)&&(i=n,n=void 0),(void 0==o||t.ngModel.$$parentForm.$name===o)&&t.ngModel&&r)){if(t.ngModel.$setDirty?t.ngModel.$setDirty():(t.ngModel.$dirty=!0,t.ngModel.$pristine=!1),n){if(s.validationMessage){if("string"==typeof s.validationMessage){var a=s.validationMessage;s.validationMessage={},s.validationMessage[202]=a}}else s.validationMessage={};s.validationMessage[r]=n}t.ngModel.$setValidity(r,i===!0),i===!0&&(t.ngModel.$validate(),t.$broadcast("schemaFormValidate"))}}),t.$on("$destroy",function(){if(!t.externalDestructionInProgress){var e=s.destroyStrategy||t.options&&t.options.destroyStrategy||"remove";if(s.key&&"retain"!==e){var r=t.model;if(s.key.length>1&&(r=c(s.key.slice(0,s.key.length-1),r)),void 0===r)return;var n=s.schema&&s.schema.type||"";"empty"===e&&-1!==n.indexOf("string")?r[s.key.slice(-1)]="":"empty"===e&&-1!==n.indexOf("object")?r[s.key.slice(-1)]={}:"empty"===e&&-1!==n.indexOf("array")?r[s.key.slice(-1)]=[]:"null"===e?r[s.key.slice(-1)]=null:delete r[s.key.slice(-1)]}}})),v()}})}}}])},l=function(r,n,i){i=e.isDefined(i)?i:!1,t.directive("sf"+String.prototype.toUpperCase(r[0])+r.substr(1),function(){return{restrict:"EAC",scope:!0,replace:!0,transclude:i,template:'<sf-decorator form="form"></sf-decorator>',link:function(t,n,i){var o={items:"c",titleMap:"c",schema:"c"},a={type:r},l=!0;e.forEach(i,function(r,n){if("$"!==n[0]&&0!==n.indexOf("ng")&&"sfField"!==n){var s=function(r){e.isDefined(r)&&r!==a[n]&&(a[n]=r,l&&a.type&&(a.key||e.isUndefined(i.key))&&(t.form=a,l=!1))};"model"===n?t.$watch(r,function(e){e&&t.model!==e&&(t.model=e)}):"c"===o[n]?t.$watchCollection(r,s):i.$observe(n,s)}})}}})};this.createDecorator=function(t,r){i[t]={__name:t},e.forEach(r,function(e,r){i[t][r]={template:e,replace:!1,builder:[]}}),i[n]||(n=t),a(t)},this.defineDecorator=function(t,r){i[t]={__name:t},e.forEach(r,function(r,n){r.builder=r.builder||[],r.replace=e.isDefined(r.replace)?r.replace:!0,i[t][n]=r}),i[n]||(n=t),a(t)},this.createDirective=l,this.createDirectives=function(t){e.forEach(t,function(e,t){l(t,e)})},this.decorator=function(e){return e=e||n,i[e]},this.addMapping=function(e,t,r,n,o){i[e]&&(i[e][t]={template:r,builder:n,replace:!!o})},this.defineAddOn=function(e,t,r,n){i[e]&&(i[e][t]={template:r,builder:n,replace:!0})},this.$get=function(){return{decorator:function(e){return i[e]||i[n]},defaultDecorator:n}},a("sfDecorator")}]),e.module("schemaForm").provider("sfErrorMessage",function(){var t={"default":"Field does not validate",0:"Invalid type, expected {{schema.type}}",1:"No enum match for: {{viewValue}}",10:'Data does not match any schemas from "anyOf"',11:'Data does not match any schemas from "oneOf"',12:'Data is valid against more than one schema from "oneOf"',13:'Data matches schema from "not"',100:"Value is not a multiple of {{schema.multipleOf}}",101:"{{viewValue}} is less than the allowed minimum of {{schema.minimum}}",102:"{{viewValue}} is equal to the exclusive minimum {{schema.minimum}}",103:"{{viewValue}} is greater than the allowed maximum of {{schema.maximum}}",104:"{{viewValue}} is equal to the exclusive maximum {{schema.maximum}}",105:"Value is not a valid number",200:"String is too short ({{viewValue.length}} chars), minimum {{schema.minLength}}",201:"String is too long ({{viewValue.length}} chars), maximum {{schema.maxLength}}",202:"String does not match pattern: {{schema.pattern}}",300:"Too few properties defined, minimum {{schema.minProperties}}",301:"Too many properties defined, maximum {{schema.maxProperties}}",302:"Required",303:"Additional properties not allowed",304:"Dependency failed - key must exist",400:"Array is too short ({{value.length}}), minimum {{schema.minItems}}",401:"Array is too long ({{value.length}}), maximum {{schema.maxItems}}",402:"Array items are not unique",403:"Additional items not allowed",500:"Format validation failed",501:'Keyword failed: "{{title}}"',600:"Circular $refs",1e3:"Unknown property (not in schema)"};t.number=t[105],t.required=t[302],t.minimum=t[101],t.maximum=t[103],t.minlength=t[200],t.maxlength=t[201],t.pattern=t[202],t.minLength=t.minlength,t.maxLength=t.maxlength,t.type="Incorrect data type, {{schema.type}} expected",t.dateFormat="Wrong date format",t.dateMin="value < {{form.minDate}}",t.dateMax="value > {{form.maxDate}}";var r={101:"minimum",103:"maximum",105:"number",201:"maxLength",200:"minLength",202:"pattern",302:"required",minlength:"minLength",maxlength:"maxLength"};this.setDefaultMessages=function(e){t=e},this.getDefaultMessages=function(){return t},this.setDefaultMessage=function(e,r){t[e]=r},this.$get=["$interpolate",function(n){var i={};return i.defaultMessages=t,i.interpolate=function(i,o,a,l,s){s=s||{};var u=l.validationMessage||{};0===i.indexOf("tv4-")&&(i=i.substring(4)),i=r[i]||i;var d=u["default"]||s["default"]||"";[u,s,t].some(function(t){return e.isString(t)||e.isFunction(t)?(d=t,!0):t&&t[i]?(d=t[i],!0):void 0});var f={error:i,value:o,viewValue:a,form:l,schema:l.schema,title:l.title||l.schema&&l.schema.title};return e.isFunction(d)?d(f):n(d)(f)},i}]}),function(){"use strict";function t(t,r,n,i,o,a){function l(e){return e.uniqueId(),e.prop("id")}function s(e,t){var r=c(e);if(r){var i=l(t);M[i]||(M[i]=r,n.enter(r,t))}}function u(e){var t=l(e),r=M[t];r&&(n.leave(r,e),delete M[t])}function d(e,t,r){return o(function(n,o){function l(){a(function(){t&&(t.httpPending=!1),f(r)&&u(r.element)},m)}t&&(t.httpPending=!0),f(r)&&s(r.spinnerSize,r.element),i(e).then(function(e){l(),n(e)},function(e){l(),o(e)})})}function f(e){return e&&e.spinnerSize&&e.element}function c(t){var r=null;if(t)switch(t){case"sm":r=y;break;case"md":r=g;break;case"lg":r=$}return null!==r?e.copy(r):null}var m=500,p='<div class="rds-spinner-overlay"><div class="vertical-align-wrapper"><div class="rds-spinner-icon-sm"></div></div></div>',h='<div class="rds-spinner-overlay"><div class="vertical-align-wrapper"><div class="rds-spinner-icon-md"></div></div></div>',v='<div class="rds-spinner-overlay"><div class="vertical-align-wrapper"><div class="rds-spinner-icon-lg"></div></div></div>';this.spinnerOverlayHtmlSmall=r.trustAsHtml(p),this.spinnerOverlayHtmlMiddle=r.trustAsHtml(h),this.spinnerOverlayHtmlLarge=r.trustAsHtml(v);var y=e.element(p),g=e.element(h),$=e.element(v);this.addSpinnerOverlay=s,this.removeSpinnerOverlay=u,this.httpWithSpinner=d;var M={}}e.module("schemaForm").service("LoadingSpinnerService",t),t.$inject=["$log","$sce","$animate","$http","$q","$timeout"]}(),e.module("schemaForm").provider("schemaForm",["sfPathProvider",function(t){var r=function(e){if(Array.isArray(e)&&2==e.length){if("null"===e[0])return e[1];if("null"===e[1])return e[0]}return e},n=function(e){var t=[];return e.forEach(function(e){t.push({name:e,value:e})}),t},i=function(t,r){if(!e.isArray(t)){var n=[];return r?e.forEach(r,function(e,r){n.push({name:t[e],value:e})}):e.forEach(t,function(e,t){n.push({name:e,value:t})}),n}return t},o=function(t,n,i){var o=h[r(n.type)];if(o)for(var a,l=0;l<o.length;l++)if(a=o[l](t,n,i))return a.schema["x-schema-form"]&&e.isObject(a.schema["x-schema-form"])&&(a=e.extend(a,a.schema["x-schema-form"])),a},a=function(t,r,n){n=n||{};var o=n.global&&n.global.formDefaults?e.copy(n.global.formDefaults):{};return n.global&&n.global.supressPropertyTitles===!0?o.title=r.title:o.title=r.title||t,r.description&&(o.description=r.description),(n.required===!0||r.required===!0)&&(o.required=!0),r.maxLength&&(o.maxlength=r.maxLength),r.minLength&&(o.minlength=r.minLength),(r.readOnly||r.readonly)&&(o.readonly=!0),r.minimum&&(o.minimum=r.minimum+(r.exclusiveMinimum?1:0)),r.maximum&&(o.maximum=r.maximum-(r.exclusiveMaximum?1:0)),r.validationMessage&&(o.validationMessage=r.validationMessage),r.enumNames&&(o.titleMap=i(r.enumNames,r["enum"])),o.schema=r,o.ngModelOptions=o.ngModelOptions||{},o},l=function(e,n,i){if("string"===r(n.type)&&!n["enum"]){var o=a(e,n,i);return o.key=i.path,o.type="text",i.lookup[t.stringify(i.path)]=o,o}},s=function(e,n,i){if("number"===r(n.type)){var o=a(e,n,i);return o.key=i.path,o.type="number",i.lookup[t.stringify(i.path)]=o,o}},u=function(e,n,i){if("integer"===r(n.type)){var o=a(e,n,i);return o.key=i.path,o.type="number",i.lookup[t.stringify(i.path)]=o,o}},d=function(e,n,i){if("boolean"===r(n.type)){var o=a(e,n,i);return o.key=i.path,o.type="checkbox",i.lookup[t.stringify(i.path)]=o,o}},f=function(e,i,o){if("string"===r(i.type)&&i["enum"]){var l=a(e,i,o);return l.key=o.path,l.type="select",l.titleMap||(l.titleMap=n(i["enum"])),o.lookup[t.stringify(o.path)]=l,l}},c=function(e,i,o){if("array"===r(i.type)&&i.items&&i.items["enum"]){var l=a(e,i,o);return l.key=o.path,l.type="checkboxes",l.titleMap||(l.titleMap=n(i.items["enum"])),o.lookup[t.stringify(o.path)]=l,l}},m=function(n,i,l){if("object"===r(i.type)){var s=a(n,i,l);return s.type="fieldset",s.key=l.path,s.items=[],l.lookup[t.stringify(l.path)]=s,e.forEach(i.properties,function(e,r){var n=l.path.slice();if(n.push(r),l.ignore[t.stringify(n)]!==!0){var a=Array.isArray(i.required)?-1!==i.required.indexOf(r):i.required,u=o(r,e,{path:n,required:a||!1,lookup:l.lookup,ignore:l.ignore,global:l.global});u&&s.items.push(u)}}),s}},p=function(e,n,i){if("array"===r(n.type)){var l=a(e,n,i);l.type="array",l.key=i.path,i.lookup[t.stringify(i.path)]=l;var s=Array.isArray(n.required)?-1!==n.required.indexOf(i.path[i.path.length-1]):n.required,u=i.path.slice();return u.push(""),l.items=[o(e,n.items,{path:u,required:s||!1,lookup:i.lookup,ignore:i.ignore,global:i.global})],l}},h={string:[f,l],object:[m],number:[s],integer:[u],"boolean":[d],array:[c,p]},v=function(e){return e};this.defaults=h,this.stdFormObj=a,this.defaultFormDefinition=o,this.postProcess=function(e){v=e},this.appendRule=function(e,t){h[e]||(h[e]=[]),h[e].push(t)},this.prependRule=function(e,t){h[e]||(h[e]=[]),h[e].unshift(t)},this.createStandardForm=a,this.$get=function(){var n={};return n.merge=function(r,o,a,l,s,u){o=o||["*"],l=l||{},s=s||r.readonly||r.readOnly;var d=n.defaults(r,a,l),f=o.indexOf("*");-1!==f&&(o=o.slice(0,f).concat(d.form).concat(o.slice(f+1)));var c=d.lookup;return v(o.map(function(o){if("string"==typeof o&&(o={key:o}),o.key&&"string"==typeof o.key&&(o.key=t.parse(o.key)),o.titleMap&&(o.titleMap=i(o.titleMap)),o.itemForm){o.items=[];var d=t.stringify(o.key),f=c[d];e.forEach(f.items,function(t){var r=e.copy(o.itemForm);r.key=t.key,o.items.push(r)})}if(o.key){var m=t.stringify(o.key);if(c[m]){var p=c[m];e.forEach(p,function(e,t){void 0===o[t]&&(o[t]=p[t])})}}return s===!0&&(o.readonly=!0),o.items&&(o.items=n.merge(r,o.items,a,l,o.readonly,u)),o.tabs&&e.forEach(o.tabs,function(e){e.items=n.merge(r,e.items,a,l,o.readonly,u)}),"checkbox"===o.type&&e.isUndefined(o.schema["default"])&&(o.schema["default"]=!1),u&&"template"===o.type&&!o.template&&o.templateUrl&&u.push(o),o}))},n.defaults=function(t,n,i){var a=[],l={};if(n=n||{},i=i||{},"object"!==r(t.type))throw new Error('Not implemented. Only type "object" allowed at root level of schema.');return e.forEach(t.properties,function(e,r){if(n[r]!==!0){var s=Array.isArray(t.required)?-1!==t.required.indexOf(r):t.required,u=o(r,e,{path:[r],lookup:l,ignore:n,required:s||!1,global:i});u&&a.push(u)}}),{form:a,lookup:l}},n.traverseSchema=function(t,r,n,i){i=e.isDefined(i)?i:!0,n=n||[];var o=function(t,r,n){if(r(t,n),e.forEach(t.properties,function(e,t){var i=n.slice();i.push(t),o(e,r,i)}),!i&&t.items){var a=n.slice();a.push(""),o(t.items,r,a)}if(i&&"array"!=t.type&&t.items){var a=n.slice();o(t.items,r,a)}};o(t,r,n||[])},n.traverseForm=function(t,r){r(t),e.forEach(t.items,function(e){n.traverseForm(e,r)}),t.tabs&&e.forEach(t.tabs,function(t){e.forEach(t.items,function(e){n.traverseForm(e,r)})})},n}}]),function(){"use strict";function t(t,r,n,i){function o(e,t,r,o){var l,s,d,f;if(!u(e))return s=e,d=t,f=r,n(s,d,f);if(l=e,void 0===t&&void 0===r&&void 0===o)s=a(l),d=l.model;else if(void 0!==t&&void 0===r&&void 0===o)s=a(l),d=l.model,f=t;else if(void 0!==t&&void 0!==r&&void 0===o)s=t,d=r;else{if(void 0===t||void 0===r||void 0===o)throw i.error("sfModelValue - incorrect param combination: ",e,t,r,o),Error("sfModelValue - incorrect param combination");s=t,d=r,f=o}return null!==s?n(s,d,f):void 0}function a(t){var r=null;if(!t.form)return null;d(t);var n=f(t);if(t.form.key)return r=e.copy(t.form.key),l(r,n),r;for(var i=t;null!=(i=i.$parent);){var o=i.form;if(o&&o.key){r=e.copy(o.key),o.schema&&"array"===o.schema.type&&r.push("");break}}return r&&n.length>0&&l(r,n),r}function l(e,t){for(var r=e.length-1;r>=0;r--)if(""===e[r])if(t.length>0){var n=t.splice(-1,1)[0];e[r]=n}else i.error("sfModelValue#_updateModelPathWithArrayIndices - Cannot find any more array index for the model path",t,e);0!==t.length&&i.error("sfModelValue#_updateModelPathWithArrayIndices - array indices found along the scope hierarcy does not match to model path",t,e)}function s(t,r){d(t);var n=f(t);if(e.isString(r)){for(var o,a=r.replace(/\[arrayIndex]/g,"[]"),s=/(\[])+/g;null!==(o=s.exec(a));)for(var u=o[0].length/2,c=0;u>c;c++)c<n.length?a=a.replace(/\[]/,"["+n[c]+"]"):i.error("sfModelValue#interpArrayIndex - Cannot find any more array index for the current match",n,o);return a}if(e.isArray(r)){var m=e.copy(r);return l(m,n),m}}function u(e){return e instanceof r.constructor}function d(e){if(!u(e))throw e+" is not a scope";if(!e.form)throw e+" does not have a form object"}function f(t){for(var r=[],n=t;n;){var i=null;n.hasOwnProperty("$gridRowIndex")?i=n.$gridRowIndex:n.hasOwnProperty("$index")&&(i=n.$index),e.isNumber(i)&&(r.unshift(i),n=n.$parent),n=n.$parent}return r}return o.getModelPath=a,o.interpArrayIndex=s,o}e.module("schemaForm").factory("sfModelValue",t),t.$inject=["sfPath","$rootScope","sfSelect","$log"]}(),e.module("schemaForm").factory("sfValidator",[function(){function t(e){for(var r in e)if(e.hasOwnProperty(r)){var n=e[r];null===n||void 0===n?delete e[r]:"object"==typeof n?t(e[r],r):null===e[r]}}var n={};return n.validate=function(n,i){if(!n)return{valid:!0};var o=n.schema;if(!o)return{valid:!0};""===i&&(i=void 0),"array"===n.type&&(i=e.copy(i),t(i),o=e.copy(n.schema),delete o.items),"number"===n.type&&null===i&&(i=void 0),-1!==["","text","textarea","date"].indexOf(n.type)&&null===i&&(i=void 0),-1!==["select","rds-dynamic-single-select","rds-dynamic-radios","radios-inline","radiobuttons"].indexOf(n.type)&&null===i&&(i=void 0),e.equals(i,[])&&(i=void 0);var a={type:"object",properties:{}},l=n.key[n.key.length-1];a.properties[l]=o,n.required&&(a.required=[l]);var s={};return e.isDefined(i)&&(s[l]=i),r.validateResult(s,a)},n}]),e.module("schemaForm").directive("sfArray",["sfSelect","schemaForm","sfValidator","sfPath",function(t,r,n,i){var o=function(e){return function(t){t.key&&(t.key[t.key.indexOf("")]=e)}};return{restrict:"A",scope:!0,require:"?ngModel",link:function(a,l,s,u){var d={};a.validateArray=e.noop,u&&a.$emit("schemaFormPropagateNgModelController",u);var f=a.$watch(s.sfArray,function(l){if(l){var s=t(l.key,a.model),c=i.normalize(l.key);if(a.$watch("model"+("["!==c[0]?".":"")+c,function(e){s=a.modelArray=e}),e.isUndefined(s)&&(s=[],t(l.key,a.model,s)),a.modelArray=s,l.items){var m=l.items[0];l.items.length>1&&(m={type:"section",items:l.items.map(function(t){return t.ngModelOptions=l.ngModelOptions,e.isUndefined(t.readonly)&&(t.readonly=l.readonly),t})})}if(a.copyWithIndex=function(t){if(!d[t]&&m){var n=e.copy(m);n.arrayIndex=t,r.traverseForm(n,o(t)),d[t]=n}return d[t]},a.appendToArray=function(){var n=s.length,i=a.copyWithIndex(n);if(r.traverseForm(i,function(r){if(r.key){var n;e.isDefined(r["default"])&&(n=r["default"]),e.isDefined(r.schema)&&e.isDefined(r.schema["default"])&&(n=r.schema["default"]),e.isDefined(n)&&t(r.key,a.model,n)}}),n===s.length){var o,u=t("schema.items.type",l);"object"===u?o={}:"array"===u&&(o=[]),s.push(o)}return a.validateArray(),s},a.deleteFromArray=function(e){return s.splice(e,1),a.validateArray(),u&&u.$setDirty&&u.$setDirty(),s},l.titleMap||l.startEmpty===!0||0!==s.length||a.appendToArray(),l.titleMap&&l.titleMap.length>0){a.titleMapValues=[];var p=function(e){a.titleMapValues=[],e=e||[],l.titleMap.forEach(function(t){a.titleMapValues.push(-1!==e.indexOf(t.value))})};p(a.modelArray),a.$watchCollection("modelArray",p),a.$watchCollection("titleMapValues",function(e,t){if(e&&e!==t){for(var r=a.modelArray;r.length>0;)r.pop();l.titleMap.forEach(function(t,n){e[n]&&r.push(t.value)}),a.validateArray()}})}if(u){var h;a.validateArray=function(){var e=n.validate(l,a.modelArray.length>0?a.modelArray:void 0);Object.keys(u.$error).filter(function(e){return 0===e.indexOf("tv4-")}).forEach(function(e){u.$setValidity(e,!0)}),e.valid!==!1||!e.error||""!==e.error.dataPath&&e.error.dataPath!=="/"+l.key[l.key.length-1]||(u.$setViewValue(a.modelArray),h=e.error,u.$setValidity("tv4-"+e.error.code,!1))},a.$on("schemaFormValidate",a.validateArray),a.hasSuccess=function(){return a.options&&a.options.pristine&&a.options.pristine.success===!1?u.$valid&&!u.$pristine&&!u.$isEmpty(u.$modelValue):u.$valid&&(!u.$pristine||!u.$isEmpty(u.$modelValue))},a.hasError=function(){return a.options&&a.options.pristine&&a.options.pristine.errors===!1?u.$invalid&&!u.$pristine:u.$invalid},a.schemaError=function(){return h}}f()}})}}}]),e.module("schemaForm").directive("sfChanged",function(){return{require:"ngModel",restrict:"AC",scope:!1,link:function(t,r,n,i){var o=t.$eval(n.sfChanged);o&&o.onChange&&i.$viewChangeListeners.push(function(){e.isFunction(o.onChange)?o.onChange(i.$modelValue,o):t.evalExpr(o.onChange,{modelValue:i.$modelValue,form:o})})}}}),e.module("schemaForm").directive("jsExpression",[function(){return{restrict:"A",scope:!1,priority:500,require:"?ngModel",link:function(e,t,r,n,i){function o(){return e.ngModel&&e.ngModel.$dirty}function a(){var t=e.ngModel.$$parentForm.$dirty;return!t&&e.ngModel.$$parentForm.$$parentForm&&(t=e.ngModel.$$parentForm.$$parentForm.$dirty),t}var l=e.form;l.schema;e.$watch(r.jsExpression,function(t){var r=!!t;e.form.jsExpressionResult=r,a()&&o()&&e.$broadcast("schemaForm.error."+e.getModelPath().join("."),"jsExpression",null,r)})}}}]),e.module("schemaForm").directive("sfMessage",["$injector","sfErrorMessage",function(t,r){var n=t.has("$sanitize")?t.get("$sanitize"):function(e){return e};return{scope:!1,restrict:"EA",link:function(t,i,o){var a="";o.sfMessage&&t.$watch(o.sfMessage,function(e){e&&(a=n(e),u(!!t.ngModel))});var l,s=function(e){e!==l&&(i.html(e),l=e)},u=function(n){if(n)if(t.hasError()){var i=[];e.forEach(t.ngModel&&t.ngModel.$error,function(e,t){e&&i.push(t)}),i=i.filter(function(e){return"schemaForm"!==e});var o=i[0];s(o?r.interpolate(o,t.ngModel.$modelValue,t.ngModel.$viewValue,t.form,t.options&&t.options.validationMessage):a)}else s(a);else s(a)};u();var d=t.$watch("ngModel",function(e){e&&(e.$parsers.push(function(e){return u(!0),e}),e.$formatters.push(function(e){return u(!0),e}),d())});t.$watchCollection("ngModel.$error",function(){u(!!t.ngModel)})}}}]),e.module("schemaForm").directive("sfNewArray",["$sce","sfSelect","sfPath","schemaForm","$timeout","$log",function(t,r,n,i,o,a){return{scope:!1,link:function(l,s,u){function d(){var e=l.getModelPath(),t="";e&&e.forEach(function(e){t+=Number.isInteger(e)?".["+e+"]":"."+e}),t&&(t=t.substr(1));var r=h();t+=".["+r.length+"]";var n=l.evalInScope("model._processInstanceId"),i=l.evalInScope("model._taskId"),o=l.form.formIdForSubModelApi,a=__sfbEnv.baseUrl+"data/";a+=i?"tid/"+i+"?path="+encodeURIComponent(t)+"&form="+encodeURIComponent(o):"pid/"+n+"?path="+encodeURIComponent(t)+"&form="+encodeURIComponent(o),f(l).openFormInDialog(o,a)}function f(t){var r=t.evalExpr("$$ctrl$$");return r?(r.openFormInDialog&&e.isFunction(r.openFormInDialog)||(r.openFormInDialog=c()),r):null}function c(){return function(){a.debug("Mock function "+arguments.callee+" is called, arguments: ",arguments)}}l.min=0,l.modelArray=l.$eval(u.sfNewArray),l.form&&l.form.htmlWhenEmptyTemplate&&(l.htmlWhenEmpty=t.trustAsHtml(l.form.htmlWhenEmptyTemplate));var m=function(){l.modelArray=l.$eval(u.sfNewArray),l.ngModel&&l.ngModel.$pristine&&l.firstDigest&&(!l.options||l.options.validateOnRender!==!0)||l.validateField&&l.validateField()},p=function(){l.form&&l.form.onChange&&(e.isFunction(l.form.onChange)?l.form.onChange(l.modelArray,l.form):l.evalExpr(l.form.onChange,{modelValue:l.modelArray,form:l.form}))},h=function(){var e=l.modelArray;if(!e){var t=n.parse(u.sfNewArray);e=[],r(t,l,e),l.modelArray=e}return e},v=l.$watch("form",function(e){if(e){if(e.titleMap||!e.startEmpty||e.readonly===!0||l.modelArray&&0!==l.modelArray.length||l.appendToArray(),l.form&&l.form.schema&&l.form.schema.uniqueItems===!0?(l.$watch(u.sfNewArray,m,!0),l.$watch([u.sfNewArray,u.sfNewArray+".length"],p)):l.$watchGroup?l.$watchGroup([u.sfNewArray,u.sfNewArray+".length"],function(){m(),p()}):(l.$watch(u.sfNewArray,function(){m(),p()}),l.$watch(u.sfNewArray+".length",function(){m(),p()})),e.titleMap&&e.titleMap.length>0){l.titleMapValues=[];var t=function(t){l.titleMapValues=[],t=t||[],e.titleMap.forEach(function(e){l.titleMapValues.push(-1!==t.indexOf(e.value))})};t(l.modelArray),l.$watchCollection("modelArray",t),l.$watchCollection("titleMapValues",function(t,r){if(t&&t!==r){var n=h();e.titleMap.forEach(function(e,r){var i=n.indexOf(e.value);-1===i&&t[r]&&n.push(e.value),-1===i||t[r]||n.splice(i,1)}),l.validateField&&o(l.validateField)}})}v()}});l.appendToArray=function(){var t=l.evalInScope("model._uiCtrlExtra.shouldEnableSubModelApiButtons");if(!(t&&l.form.readonly&&l.form.formIdForSubModelApi)){var n,o=h();if(l.form&&l.form.schema&&l.form.schema.items){var a=l.form.schema.items;a.type&&-1!==a.type.indexOf("object")?(n={},l.options&&l.options.setSchemaDefaults===!1||(n=e.isDefined(a["default"])?a["default"]:n,n&&i.traverseSchema(a,function(t,i){e.isDefined(t["default"])&&r(i,n,t["default"])}))):a.type&&-1!==a.type.indexOf("array")?(n=[],l.options&&l.options.setSchemaDefaults===!1||(n=a["default"]||n)):l.options&&l.options.setSchemaDefaults===!1||(n=a["default"]||n)}return o.push(n),o}d()},l.deleteFromArray=function(e){var t=l.modelArray;return t&&t.splice(e,1),t},l.indexDown=function(e){var t=l.modelArray;if(t&&e>0&&e<t.length){var r=t[e-1];return t[e-1]=t[e],t[e]=r,e-1}return e},l.indexUp=function(e){var t=l.modelArray;if(t&&e>=0&&e<t.length-1){var r=t[e+1];return t[e+1]=t[e],t[e]=r,e+1}return e};var y=function(e){return function(t){t.key&&(t.key[t.key.indexOf("")]=e)}},g={};l.copyWithIndex=function(t){var r=l.form;if(!g[t]){var n=r.items[0];if(r.items.length>1&&(n={type:"section",items:r.items.map(function(t){return t.ngModelOptions=r.ngModelOptions,e.isUndefined(t.readonly)&&(t.readonly=r.readonly),t})}),n){var o=e.copy(n);o.arrayIndex=t,i.traverseForm(o,y(t)),g[t]=o}}return g[t]},l.shouldShowAsUsedWithSubmodelAPI=function(){return l.evalInScope("model._uiCtrlExtra.shouldEnableSubModelApiButtons")&&!l.form.disableAdd&&l.form.formIdForSubModelApi}}}}]),e.module("schemaForm").directive("sfSchema",["$compile","$http","$templateCache","$q","schemaForm","schemaFormDecorators","sfSelect","sfPath","sfBuilder","__sfbEnv","$log",function(t,r,n,i,o,a,l,s,u,d,f){
var c=d&&d.utils;return c||f.error("schemaForm#internalRender - 'utils' property is missing from __sfbEnv. AngularJS expressions using 'utils' will all fail. __sfbEnv is:",d),{scope:{schema:"=sfSchema",initialForm:"=sfForm",model:"=sfModel",options:"=sfOptions"},controller:["$scope",function(e){this.evalInParentScope=function(t,r){return r=_.merge(r,{utils:c,env:d}),e.$parent.$eval(t,r)};var t=this;e.lookup=function(e){return e&&(t.lookup=e),t.lookup}}],replace:!1,restrict:"A",transclude:!0,require:"?form",link:function(l,s,f,m,p){l.formCtrl=m;var h={};p(l,function(e){if(e.addClass("schema-form-ignore"),s.prepend(e),s[0].querySelectorAll){var t=s[0].querySelectorAll("[ng-model]");if(t)for(var r=0;r<t.length;r++){var n=t[r].getAttribute("ng-model");h[n.substring(n.indexOf(".")+1)]=!0}}});var v,y={},g=function(e,t){var a=[],s=o.merge(e,t,h,l.options,void 0,a);a.length>0?i.all(a.map(function(e){return r.get(e.templateUrl,{cache:n}).then(function(t){e.template=t.data})})).then(function(){$(e,t,s)}):$(e,t,s)},$=function(e,r,n){v&&(l.externalDestructionInProgress=!0,v.$destroy(),l.externalDestructionInProgress=!1),v=l.$new(),v.schemaForm={form:n,schema:e},v.utils=c,v.env=d,s.children(":not(.schema-form-ignore)").remove();for(var i={},o=s[0].querySelectorAll("*[sf-insert-field]"),m=0;m<o.length;m++)i[o[m].getAttribute("sf-insert-field")]=o[m];var p=a.decorator(f.sfUseDecorator),h=Object.create(null);l.lookup(h),s[0].appendChild(u.build(n,p,i,h)),v.firstDigest=!0,setTimeout(function(){v.firstDigest=!1},0),t(s.children())(v),l.$emit("sf-render-finished",s)},M=["*"];l.$watch(function(){var e=l.schema,t=l.initialForm||M;t&&e&&e.type&&(y.form!==t||y.schema!==e)&&(y.schema=e,y.form=t,g(e,t))}),l.$on("schemaFormRedraw",function(){var t=l.schema,r=l.initialForm?e.copy(l.initialForm):["*"];t&&g(t,r)}),l.$on("$destroy",function(){l.externalDestructionInProgress=!0}),l.evalExpr=function(e,t){return t=_.merge(t,{utils:c,env:d}),l.$parent.$eval(e,t)}}}}]),e.module("schemaForm").directive("schemaValidate",["sfValidator","$parse","sfSelect","$timeout",function(t,r,n,i){return{restrict:"A",scope:!1,priority:500,require:"ngModel",link:function(r,o,a,l){function s(e){if(!f)return e;if(r.options&&r.options.tv4Validation===!1)return e;var n=t.validate(f,e);return Object.keys(l.$error).filter(function(e){return 0===e.indexOf("tv4-")}).forEach(function(e){l.$setValidity(e,!0)}),l.$setValidity("jsExpression",!0),l.$setValidity("remoteValidation",!0),n.valid?(null!==d&&i(function(){r.$emit("internal-schemaFormValidate-revalidate-containing-array-if-any")}),d=null,f.jsExpressionResult===!1?(l.$setValidity("jsExpression",!1),d={code:"jsExpression"},e):f.remoteValidationResult===!1?(l.$setValidity("remoteValidation",!1),d={code:"remoteValidation"},e):e):(l.$setValidity("tv4-"+n.error.code,!1),d=n.error,l.$validators?e:void 0)}function u(t){function r(){return l.$isEmpty(l.$modelValue)||c&&-1!==c.type.indexOf("array")&&e.equals(l.$modelValue,[])}if(void 0==t||l.$$parentForm.$name===t)if(c&&-1!==c.type.indexOf("array")&&s(l.$modelValue),l.$setDirty){if(l.$setDirty(),l.$setViewValue(l.$viewValue),l.$commitViewValue(),l.$setValidity("tv4-302",!0),f.required){if(r())return void l.$setValidity("tv4-302",!1);l.$setValidity("tv4-302",!0)}if(f.jsExpressionResult===!1)return void l.$setValidity("jsExpression",!1);f.jsExpressionResult&&l.$setValidity("jsExpression",!0),f.remoteValidationResult===!1?l.$setValidity("remoteValidation",!1):f.remoteValidationResult&&l.$setValidity("remoteValidation",!0)}else l.$setViewValue(l.$viewValue)}r.$emit("schemaFormPropagateNgModelController",l);var d=null,f=r.$eval(a.schemaValidate);f.copyValueTo&&l.$viewChangeListeners.push(function(){var t=f.copyValueTo;e.forEach(t,function(e){n(e,r.model,l.$modelValue)})}),"function"==typeof f.ngModel&&f.ngModel(l),["$parsers","$viewChangeListeners","$formatters"].forEach(function(e){f[e]&&l[e]&&f[e].forEach(function(t){l[e].push(t)})}),["$validators","$asyncValidators"].forEach(function(t){f[t]&&l[t]&&e.forEach(f[t],function(e,r){l[t][r]=e})}),l.$parsers.push(s),l.$validators&&(l.$validators.schemaForm=function(){return!Object.keys(l.$error).some(function(e){return"schemaForm"!==e&&"jsExpression"!==e&&"remoteValidation"!==e&&"dateFormat"!==e&&"dateMin"!==e&&"dateMax"!==e})});var c=f.schema;r.validateField=u;var m=!0;l.$formatters.push(function(e){return!l.$pristine||!m||r.options&&r.options.validateOnRender===!0?(l.$pristine||s(l.$modelValue),e):(m=!1,e)}),r.$on("schemaFormValidate",function(e,t){r.validateField(t)}),r.$on("internal-schemaFormValidate-revalidate-containing-array-if-any",function(e){r.form&&"array"===r.form.type&&(r.validateField(),l.$validate())}),r.schemaError=function(){return d}}}}]),e.module("schemaForm").directive("sfField",["$parse","$compile","$http","$templateCache","$interpolate","$q","sfErrorMessage","sfPath","sfSelect","sfModelValue","$log","$timeout","LoadingSpinnerService","$sce","__sfbEnv",function(t,r,n,i,o,a,l,s,u,d,f,c,m,p,h){return{restrict:"AE",replace:!1,transclude:!1,scope:!0,require:"^sfSchema",link:{pre:function(t,r,n,i){t.$on("schemaFormPropagateNgModelController",function(e,r){e.stopPropagation(),e.preventDefault(),t.ngModel=r}),t.form=i.lookup["f"+n.sfField]?i.lookup["f"+n.sfField]:t.form;var o=d(t);(!t.options||t.options.setSchemaDefaults!==!1)&&t.form.schema&&t.form.schema["default"]&&e.isUndefined(o)&&d(t,t.form.schema["default"])},post:function(r,n,i,a){function s(){var t=r.ngModel,n=r.form.schema;return t.$isEmpty(t.$modelValue)||n&&-1!==n.type.indexOf("array")&&e.equals(t.$modelValue,[])}r.showTitle=function(){return r.form&&r.form.notitle!==!0&&r.form.title},r.listToCheckboxValues=function(t){var r={};return e.forEach(t,function(e){r[e]=!0}),r},r.checkboxValuesToList=function(t){var r=[];return e.forEach(t,function(e,t){e&&r.push(t)}),r},r.buttonClick=function(t,n){e.isFunction(n.onClick)?n.onClick(t,n):e.isString(n.onClick)&&(a?a.evalInParentScope(n.onClick,{$event:t,form:n,model:r.model}):r.$eval(n.onClick,{$event:t,form:n,model:r.model}))},r.evalExpr=function(e,t){return a?a.evalInParentScope(e,t):r.$eval(e,t)},r.evalInScope=function(e,t){return e?r.$eval(e,t):void 0},r.interp=function(e,t){return e&&o(e)(t)},r.modelValue=function(e){var t=this;return d(t,e)},r.interpArrayIndex=function(e){var t=this;return d.interpArrayIndex(t,e)},r.getModelPath=function(){var e=this;return d.getModelPath(e)},r.trustAsHtml=function(e){return p.trustAsHtml(e)},r.encodeURIComponent=function(e){return void 0!==e&&null!==e&&""!==e?encodeURIComponent(e):""};var v=h&&h.utils;v||f.error("sfField#postLink - 'utils' property is missing from __sfbEnv. AngularJS expressions using 'utils' will all fail. __sfbEnv is:",h),r.utils=v,r.env=h,r.spinnerOverlayHtmlSmall=m.spinnerOverlayHtmlSmall,r.spinnerOverlayHtmlMiddle=m.spinnerOverlayHtmlMiddle,r.spinnerOverlayHtmlLarge=m.spinnerOverlayHtmlLarge,r.hasSuccess=function(){return r.ngModel?r.options&&r.options.pristine&&r.options.pristine.success===!1?r.ngModel.$valid&&!r.ngModel.$pristine&&!s():r.ngModel.$valid&&(!r.ngModel.$pristine||!s()):!1},r.hasError=function(){return r.ngModel?r.options&&r.options.pristine&&r.options.pristine.errors===!1?r.ngModel.$invalid&&!r.ngModel.$pristine:r.ngModel.$invalid:!1},r.errorMessage=function(e){return l.interpolate(e&&e.code+""||"default",r.ngModel&&r.ngModel.$modelValue||"",r.ngModel&&r.ngModel.$viewValue||"",r.form,r.options&&r.options.validationMessage)};var y=r.form;if(y.key&&(r.$on("schemaForm.error."+r.getModelPath().join("."),function(e,t,n,i){if(("jsExpression"!==t||i!==!0||r.ngModel.$error.jsExpression)&&("remoteValidation"!==t||i!==!0||r.ngModel.$error.remoteValidation)&&r.ngModel&&t){if(r.ngModel.$setDirty?r.ngModel.$setDirty():(r.ngModel.$dirty=!0,r.ngModel.$pristine=!1),n){if(y.validationMessage){if("string"==typeof y.validationMessage){var o=y.validationMessage;y.validationMessage={},y.validationMessage[202]=o}}else y.validationMessage={};y.validationMessage[t]=n}r.ngModel.$setValidity(t,i===!0),i===!0&&(r.ngModel.$validate(),r.$broadcast("schemaFormValidate"))}}),r.$on("$destroy",function(){if(!r.externalDestructionInProgress){var e=y.destroyStrategy||r.options&&r.options.destroyStrategy||"remove",t=r.getModelPath();if(t&&"retain"!==e){var n=r.model;if(t.length>1&&(n=u(t.slice(0,t.length-1),n)),void 0===n)return;var i=y.schema&&y.schema.type||"";"empty"===e&&-1!==i.indexOf("string")?n[t.slice(-1)]="":"empty"===e&&-1!==i.indexOf("object")?n[t.slice(-1)]={}:"empty"===e&&-1!==i.indexOf("array")?n[t.slice(-1)]=[]:"null"===e?n[t.slice(-1)]=null:delete n[t.slice(-1)]}}})),y.derivedFrom){y.readonly=!0;var g=y.derivedFrom;f.debug("sfField#derivedFromPropertyHandler - "+e.toJson(y.key)+" has derived-value expression: "+g),r.model||f.warn("sfField#derivedFromPropertyHandler - "+e.toJson(y.key)+" is not associated with the form model, so won't do anything here");var $;try{$=t(g)}catch(M){return void f.error("sfField#derivedFromPropertyHandler - derived-value expression: "+y.derivedFrom+" is invalid")}c(function(){var t=r.ngModel;if(!t)return void f.warn("sfField#derivedFromPropertyHandler - "+e.toJson(y.key)+" is not associated with an ng-model, so won't do anything here");var n=r.getModelPath();r.$watch(function(){var t=e.copy(r.model);return _.set(t,n,null),t},function(t,n){e.equals(t,n)||c(function(){var n=$({model:t});r.modelValue(n),f.debug("sfField#derivedFromPropertyHandler - updated "+e.toJson(y.key)+" to "+n+" by derived-value expression: "+g)})},!0),f.debug("sfField#derivedFromPropertyHandler - watching model for updating "+e.toJson(y.key)+" with derived-value expression: "+g)})}y.focusOnStart===!0&&c(function(){e.element("input, select, textarea",n).first().focus()})}}}}]),o});